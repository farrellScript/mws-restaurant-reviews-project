!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";!function(){function e(t){return new Promise(function(e,r){t.onsuccess=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function r(t,r,n){var a,o=new Promise(function(o,s){e(a=t[r].apply(t,n)).then(o,s)});return o.request=a,o}function n(t,e,r){r.forEach(function(r){Object.defineProperty(t.prototype,r,{get:function(){return this[e][r]},set:function(t){this[e][r]=t}})})}function a(t,e,n,a){a.forEach(function(a){a in n.prototype&&(t.prototype[a]=function(){return r(this[e],a,arguments)})})}function o(t,e,r,n){n.forEach(function(n){n in r.prototype&&(t.prototype[n]=function(){return this[e][n].apply(this[e],arguments)})})}function s(t,e,n,a){a.forEach(function(a){a in n.prototype&&(t.prototype[a]=function(){return function(t,e,n){var a=r(t,e,n);return a.then(function(t){if(t)return new u(t,a.request)})}(this[e],a,arguments)})})}function i(t){this._index=t}function u(t,e){this._cursor=t,this._request=e}function c(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,r){t.oncomplete=function(){e()},t.onerror=function(){r(t.error)},t.onabort=function(){r(t.error)}})}function h(t,e,r){this._db=t,this.oldVersion=e,this.transaction=new l(r)}function f(t){this._db=t}n(i,"_index",["name","keyPath","multiEntry","unique"]),a(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(u,"_cursor",["direction","key","primaryKey","value"]),a(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(u.prototype[t]=function(){var r=this,n=arguments;return Promise.resolve().then(function(){return r._cursor[t].apply(r._cursor,n),e(r._request).then(function(t){if(t)return new u(t,r._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},n(c,"_store",["name","keyPath","indexNames","autoIncrement"]),a(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(c,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},n(l,"_tx",["objectStoreNames","mode"]),o(l,"_tx",IDBTransaction,["abort"]),h.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},n(h,"_db",["name","version","objectStoreNames"]),o(h,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[c,i].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),r=e[e.length-1],n=this._store||this._index,a=n[t].apply(n,e.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[i,c].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var r=this,n=[];return new Promise(function(a){r.iterateCursor(t,function(t){t?(n.push(t.value),void 0===e||n.length!=e?t.continue():a(n)):a(n)})})})});var d={open:function(t,e,n){var a=r(indexedDB,"open",[t,e]),o=a.request;return o&&(o.onupgradeneeded=function(t){n&&n(new h(o.result,t.oldVersion,o.transaction))}),a.then(function(t){return new f(t)})},delete:function(t){return r(indexedDB,"deleteDatabase",[t])}};t.exports=d,t.exports.default=t.exports}()},function(t,e,r){"use strict";r.r(e);class n{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(t){fetch(n.DATABASE_URL).then(function(e){if(200===e.status)return e.json();{const r=`Request failed. Returned status of ${e.body}`;t(r,null)}}).then(function(e){t(null,e)}).catch(function(t){console.log("error: ",t)})}static fetchRestaurantById(t,e){n.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.find(e=>e.id==t);r?e(null,r):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){n.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){n.fetchRestaurants((r,n)=>{if(r)e(r,null);else{const r=n.filter(e=>e.neighborhood==t);e(null,r)}})}static urlTextForRestaurant(t){return`View Details For ${t.name}`}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}.jpg`}static imageTextForRestaurant(t){return`${t.name}`}static ratingForRestaurant(t){fetch(`http://localhost:1337/reviews/?restaurant_id=${t.id}`).then(t=>t.json()).then(t=>{let e=0,r=0;return t.map(t=>{e++,r+=parseInt(t.rating)}),Math.round(r/e)})}static imageSrcSetForRestaurant(t){return`/img/${t.photograph}_1x.jpg 1x, /img/${t.photograph}_2x.jpg 2x`}static imageJpgSrcSetForRestaurant(t){return`/img/${t.photograph}_1x.jpg 1x, /img/${t.photograph}_2x.jpg 2x`}static imageWebPSrcSetForRestaurant(t){return`/img/${t.photograph}_1x.webp 1x, /img/${t.photograph}_2x.webp 2x`}static imageSrcForRestaurant(t){return`/img/${t.photograph}_1x.jpg`}}var a=r(0),o=r.n(a);const s=o.a.open("mwsrestaurants",2,function(t){switch(t.oldVersion){case 0:t.createObjectStore("restaurants",{keyPath:"id"});case 1:t.createObjectStore("reviews",{keyPath:"id"})}});self.addEventListener("message",function(t){switch(t.data.action){case"fetchNeighborhoods":n.fetchRestaurants((t,e)=>{if(t)self.postMessage("error");else{const t=e.map((t,r)=>e[r].neighborhood),r=t.filter((e,r)=>t.indexOf(e)==r);self.postMessage({action:"fetchNeighborhoods",neighborhoods:r})}});break;case"fetchCuisines":n.fetchRestaurants((t,e)=>{if(t)self.postMessage("error");else{const t=e.map((t,r)=>e[r].cuisine_type),r=t.filter((e,r)=>t.indexOf(e)==r);self.postMessage({action:"fetchCuisines",cuisines:r})}});break;case"fetchRestaurantByCuisineAndNeighborhood":n.fetchRestaurants((e,r)=>{if(e)self.postMessage("error");else{let e=r;"all"!=t.data.cuisine&&(e=e.filter(e=>e.cuisine_type==t.data.cuisine)),"all"!=t.data.neighborhood&&(e=e.filter(e=>e.neighborhood==t.data.neighborhood)),self.postMessage({action:"fetchRestaurantByCuisineAndNeighborhood",results:e})}});break;case"createRestaurantHTML":const e=t.data.restaurant,r=n.imageWebPSrcSetForRestaurant(e),a=n.imageJpgSrcSetForRestaurant(e),i=n.imageTextForRestaurant(e),u=n.imageUrlForRestaurant(e),c=n.urlTextForRestaurant(e),l=n.urlForRestaurant(e),h=fetch(`http://localhost:1337/restaurants/${t.data.restaurant.id}`).then(t=>t.json()).then(t=>t),f=fetch(`http://localhost:1337/reviews/?restaurant_id=${t.data.restaurant.id}`).then(t=>t.json()).then(t=>{let e=0,r=0;return t.map(t=>{e+=1,r+=parseInt(t.rating)}),Math.round(r/e)}).catch(function(){return s.then(function(e){return e.transaction("reviews").objectStore("reviews").get(`?restaurant_id=${t.data.restaurant.id}`)}).then(function(t){let e=0,r=0;return t.data.map(t=>{e+=1,r+=parseInt(t.rating)}),Math.round(r/e)})});Promise.all([h,f,r,a,i,u,c,l]).then(t=>{self.postMessage({action:"createRestaurantHTML",restaurant:t[0],reviews:t[1],webpsrcset:r,jpgsrcset:a,imagetext:i,imageurl:u,urltext:c,url:l})});break;case"fetchRestaurantById":const d=fetch(`http://localhost:1337/restaurants/${t.data.id}`).then(t=>t.json()).then(t=>{const e=n.imageWebPSrcSetForRestaurant(t),r=n.imageJpgSrcSetForRestaurant(t),a=n.imageTextForRestaurant(t),o=n.imageUrlForRestaurant(t);return Promise.all([t,e,r,a,o]).then(t=>t)}).catch(()=>{console.log("error")}),p=fetch(`http://localhost:1337/reviews/?restaurant_id=${t.data.id}`).then(t=>t.json()).then(t=>{let e=0,r=0;return t.map(t=>{e+=1,r+=parseInt(t.rating)}),Math.round(r/e)}).catch(()=>s.then(function(e){return e.transaction("reviews").objectStore("reviews").get(`?restaurant_id=${t.data.id}`)}).then(function(t){let e=0,r=0;return t.data.map(t=>{e+=1,r+=parseInt(t.rating)}),Math.round(r/e)}));Promise.all([d,p]).then(t=>{self.postMessage({action:"fetchRestaurantById",restaurant:t[0][0],reviews:t[1],webpsrcset:t[0][1],jpgsrcset:t[0][2],imagetext:t[0][3],imageurl:t[0][4]})});break;case"fillReviewsHTML":fetch(`http://localhost:1337/reviews/?restaurant_id=${t.data.id}`).then(t=>t.json()).then(t=>{self.postMessage({action:"fillReviewsHTML",reviews:t.data?t.data:t})}).catch(()=>{console.log("error")});case"postReview":t.data.data&&fetch("http://localhost:1337/reviews/",{method:"post",body:JSON.stringify(t.data.data)}).then(t=>t.json()).then(e=>{let r=e;return s.then(function(e){return e.transaction("reviews").objectStore("reviews").get(`?restaurant_id=${t.data.data.restaurant_id}`)}).then(function(t){let e=t.data;e.push(r);let n={id:t.id,data:e};return o.a.open("mwsrestaurants").then(t=>{return t.transaction("reviews","readwrite").objectStore("reviews").put(n)})}).then(function(){console.log("postReview",e),self.postMessage({action:"postReview",restaurant_id:e.restaurant_id})})}).catch(e=>s.then(function(e){return e.transaction("reviews").objectStore("reviews").get(`?restaurant_id=${t.data.data.restaurant_id}`)}).then(function(e){let r=e.data;r.push(t.data.data);let n={id:e.id,data:r};return o.a.open("mwsrestaurants").then(t=>{return t.transaction("reviews","readwrite").objectStore("reviews").put(n)})}).then(function(){console.log("time to add a sync"),self.postMessage({action:"postReview",restaurant_id:t.data.data.restaurant_id})}));break;case"favoriteRestaurant":console.log("favorite"),fetch(`http://localhost:1337/restaurants/${t.data.id}/?is_favorite=${t.data.value}`,{method:"PUT"}).then(function(t){return t.json()}).then(function(e){console.log("res",e);let r=e;return s.then(function(e){return e.transaction("restaurants").objectStore("restaurants").get(`${t.data.id}`)}).then(function(t){let e={id:`${r.id}`,data:r};return console.log("newReviews",e),o.a.open("mwsrestaurants").then(t=>{return t.transaction("restaurants","readwrite").objectStore("restaurants").put(e)})}).then(function(){self.postMessage({action:"favoriteRestaurant",favorite:t.data.value})})}).catch(function(){return console.log("whoops"),s.then(function(e){return e.transaction("restaurants").objectStore("restaurants").get(`${t.data.id}`)}).then(function(e){let r=e;r.data.is_favorite=`${t.data.value}`;let n={id:t.data.id,data:r.data};return console.log("newReviews",n.data),o.a.open("mwsrestaurants").then(t=>{return t.transaction("restaurants","readwrite").objectStore("restaurants").put(n)})}).then(function(){self.postMessage({action:"favoriteRestaurant",favorite:t.data.value})})});break;default:console.log("none of the above")}},!1)}]);