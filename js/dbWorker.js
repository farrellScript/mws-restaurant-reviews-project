importScripts("./dbhelper.js"),self.addEventListener("message",function(e){switch(e.data.action){case"fetchNeighborhoods":DBHelper.fetchRestaurants((e,t)=>{if(e)self.postMessage("error");else{const e=t.map((e,s)=>t[s].neighborhood),s=e.filter((t,s)=>e.indexOf(t)==s);self.postMessage({neighborhoods:s})}});break;case"fetchCuisines":DBHelper.fetchRestaurants((e,t)=>{if(e)self.postMessage("error");else{const e=t.map((e,s)=>t[s].cuisine_type),s=e.filter((t,s)=>e.indexOf(t)==s);self.postMessage({cuisines:s})}});break;case"fetchRestaurantByCuisineAndNeighborhood":DBHelper.fetchRestaurants((t,s)=>{if(t)self.postMessage("error");else{console.log("e.data",e.data.neighborhood);let t=s;console.log("results",t),"all"!=e.data.cuisine&&(t=t.filter(t=>t.cuisine_type==e.data.cuisine)),"all"!=e.data.neighborhood&&(t=t.filter(t=>t.neighborhood==e.data.neighborhood)),self.postMessage({results:t})}});break;case"createRestaurantHTML":const t=e.data.restaurant,s=DBHelper.imageWebPSrcSetForRestaurant(t),a=DBHelper.imageJpgSrcSetForRestaurant(t),r=DBHelper.imageTextForRestaurant(t),o=DBHelper.imageUrlForRestaurant(t),n=DBHelper.urlTextForRestaurant(t),l=DBHelper.urlForRestaurant(t),i=fetch(`http://localhost:1337/restaurants/${e.data.restaurant.id}`).then(e=>e.json()).then(e=>e),h=fetch(`http://localhost:1337/reviews/?restaurant_id=${e.data.restaurant.id}`).then(e=>e.json()).then(e=>{let t=0,s=0;return e.map(e=>{t+=1,s+=parseInt(e.rating)}),Math.round(s/t)});Promise.all([i,h,s,a,r,o,n,l]).then(e=>{self.postMessage({restaurant:e[0],reviews:e[1],webpsrcset:s,jpgsrcset:a,imagetext:r,imageurl:o,urltext:n,url:l})});break;case"fetchRestaurantById":const c=fetch(`http://localhost:1337/restaurants/${e.data.id}`).then(e=>e.json()).then(e=>e),u=fetch(`http://localhost:1337/reviews/?restaurant_id=${e.data.id}`).then(e=>e.json()).then(e=>{let t=0,s=0;return e.map(e=>{t+=1,s+=parseInt(e.rating)}),Math.round(s/t)});Promise.all([c,u]).then(e=>{console.log("values",e),self.postMessage({restaurant:e[0],reviews:e[1]})});break;case"fillReviewsHTML":fetch(`http://localhost:1337/reviews/?restaurant_id=${e.data.id}`).then(e=>e.json()).then(e=>{self.postMessage({reviews:e})});default:console.log("none of the above")}},!1);