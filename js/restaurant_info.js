// Create Link Element for Stylesheet
let myCSS = document.createElement("link");
myCSS.rel = "stylesheet";
myCSS.href = "/css/leaflet.css";
// insert it at the end of the head in a legacy-friendly manner
document.head.insertBefore(myCSS, document.head.childNodes[document.head.childNodes.length - 1].nextSibling);

let restaurant;
var newMap;

/**
 * Check to see if service worker is supported by the browser 
 */
if ('serviceWorker' in navigator) {

  /* if it is, register the service worker */
  navigator.serviceWorker.register('/sw.js').then(function (res) {

    // Already on the latest version, bail
    if (!navigator.serviceWorker.controller) {
      return;
    }
    // Check to see if there's a waiting service worker
    if (res.waiting) {
      _updateReady();
      return;
    }

    if (res.installing) {
      _trackInstalling(res.installing);
      return;
    }

    res.addEventListener('updatefound', function () {
      _trackInstalling(res.installing);
    });
  }).catch(function (error) {
    console.log('error registering service worker: ', error);
  });

  function _trackInstalling(worker) {
    worker.addEventListener('statechange', function () {
      if (worker.state == 'installed') {
        _updateReady(worker);
      }
    });
  }

  var focusedElement;
  /**
   * Notifies the user that an updated SW is available
   */
  function _updateReady(worker) {
    // If the user clicks on the update button, update the service worker
    document.getElementById('update-version').addEventListener('click', function () {
      worker.postMessage({ action: 'skipWaiting' });
    });
    // If the user clicks the dismiss button, hide the toast
    document.getElementById('dismiss-version').addEventListener('click', function () {
      document.getElementById('toast').classList.remove('active');
      focusedElement.focus();
    });
    // If the toast is displaying, listen for keyboard events
    document.getElementById('toast').addEventListener('keydown', function (e) {
      //Check for Tab key press
      if (e.keyCode === 9) {

        if (e.shiftKey) {
          //Pressed Shift Tab
          if (document.activeElement === firstTabStop) {
            e.preventDefault();
            lastTabStop.focus();
          }
        } else {
          //Pressed Tab
          if (document.activeElement === lastTabStop) {
            e.preventDefault();
            firstTabStop.focus();
          }
        }
      }
      // Escape Key
      if (e.keyCode === 27) {
        document.getElementById('toast').classList.remove('active');
        focusedElement.focus();
      }
    });

    // Remember what the last element that was focused was, and make it focusable so we can return to it
    focusedElement = document.activeElement;
    focusedElement.tabindex = 1;

    // When the toast is visible, this is what we'll use to temporarily trap focus
    var focusableElementsString = '#toast p, #update-version, #dismiss-version';
    var focusableElements = document.querySelectorAll(focusableElementsString);
    focusableElements = Array.prototype.slice.call(focusableElements);

    var firstTabStop = focusableElements[0];
    var lastTabStop = focusableElements[focusableElements.length - 1];

    // Ok time to show the toast and focus on it
    document.getElementById('toast').classList.add('active');
    document.querySelector('#toast p').focus();
  }

  /**
   * Listens for a change in the SW, reloads the page as a result
   */
  var refreshing;
  navigator.serviceWorker.addEventListener('controllerchange', function () {
    console.log('controller change');
    if (refreshing) return;
    window.location.reload();
    refreshing = true;
  });
}

/**
  * Initialize map as soon as the page is loaded.
 */
document.addEventListener('DOMContentLoaded', event => {
  initMap();
});

/**
 * Initialize leaflet map
 */
initMap = () => {
  fetchRestaurantFromURL((error, restaurant) => {
    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.newMap = L.map('map', {
        center: [restaurant.latlng.lat, restaurant.latlng.lng],
        zoom: 16,
        scrollWheelZoom: false
      });
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
        mapboxToken: 'pk.eyJ1IjoiZmFycmVsbHNjcmlwdCIsImEiOiJjamJiaTl3dHMxOGxsMzJwZTlmYnN4ZHN5In0.6Ey50el0atwjDygO_cO0sA',
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(newMap);
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
    }
  });
};

/* window.initMap = () => {
} */

/**
 * Get current restaurant from page URL.
 */
fetchRestaurantFromURL = callback => {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }
  const id = getParameterByName('id');
  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, (error, restaurant) => {
      self.restaurant = restaurant;
      if (!restaurant) {
        console.error(error);
        return;
      }
      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};

/**
 * Create restaurant HTML and add it to the webpage
 */
fillRestaurantHTML = (restaurant = self.restaurant) => {
  const name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;

  // Review of the restaurant
  const rating = document.getElementById('rating');
  const emptyStars = 5 - DBHelper.ratingForRestaurant(restaurant);
  for (let i = 0; i < DBHelper.ratingForRestaurant(restaurant); i++) {
    const fullstar = document.createElement('img');
    fullstar.className = "restaurant__star restaurant__star--full";
    fullstar.src = "/img/fullstar.svg";
    fullstar.alt = "";
    rating.append(fullstar);
  }
  for (let i = 0; i < emptyStars; i++) {
    const emptystar = document.createElement('img');
    emptystar.className = "restaurant__star restaurant__star--empty";
    emptystar.src = "/img/emptystar.svg";
    emptystar.alt = "";
    rating.append(emptystar);
  }

  const address = document.getElementById('restaurant-address');
  address.innerHTML = restaurant.address;

  const addressicon = document.createElement('img');
  addressicon.className = 'restaurantdetail__icon';
  addressicon.src = '/img/waypoint.svg';
  addressicon.alt = '';
  address.prepend(addressicon);

  const image = document.getElementById('restaurant-img');
  image.className = 'restaurant-img';
  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = DBHelper.imageTextForRestaurant(restaurant);
  image.srcset = DBHelper.imageSrcSetForRestaurant(restaurant);

  const cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = restaurant.cuisine_type;

  const cuisineicon = document.createElement('img');
  cuisineicon.className = 'restaurantdetail__icon';
  cuisineicon.src = '/img/cuisine.svg';
  cuisineicon.alt = '';
  cuisine.prepend(cuisineicon);

  // fill operating hours
  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();

    const hours = document.getElementById('restaurantdetail__hourscontainer');

    const hoursicon = document.createElement('img');
    hoursicon.className = 'restaurantdetail__icon';
    hoursicon.src = '/img/clock.svg';
    hoursicon.alt = '';
    hours.prepend(hoursicon);
  }
  // fill reviews
  fillReviewsHTML();
};

/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */
fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {
  const hours = document.getElementById('restaurant-hours');
  for (let key in operatingHours) {
    const row = document.createElement('tr');

    const day = document.createElement('td');
    day.className = 'restaurantdetail__day';
    day.innerHTML = key;
    row.appendChild(day);

    const time = document.createElement('td');
    time.className = 'restaurantdetail__hour';
    time.innerHTML = operatingHours[key];
    row.appendChild(time);

    hours.appendChild(row);
  }
};

/**
 * Create all reviews HTML and add them to the webpage.
 */
fillReviewsHTML = (reviews = self.restaurant.reviews) => {
  const container = document.getElementById('reviews-container');
  const title = document.createElement('h3');
  title.innerHTML = 'Reviews';
  title.className = 'restaurantdetail__reviewstitle';
  container.appendChild(title);

  if (!reviews) {
    const noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }
  const ul = document.getElementById('reviews-list');
  reviews.forEach(review => {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};

/**
 * Create review HTML and add it to the webpage.
 */
createReviewHTML = review => {
  const li = document.createElement('li');
  li.className = 'restaurantdetail__review';
  const commentHeader = document.createElement('div');
  commentHeader.className = 'restaurantdetail__commentheader';

  const leftdiv = document.createElement('div');
  leftdiv.className = 'restaurantdetail__avatarcontainer';

  const avatar = document.createElement('img');
  avatar.src = '/img/avatar.svg';
  avatar.className = 'restaurantdetail__avatar';
  avatar.alt = 'Avatar photo';
  leftdiv.appendChild(avatar);
  commentHeader.appendChild(leftdiv);

  const rightdiv = document.createElement('div');
  rightdiv.className = 'restaurantdetail__namecontainer';

  const name = document.createElement('p');
  name.innerHTML = review.name;
  rightdiv.appendChild(name);

  // Create Stars for Review
  const individualrating = document.createElement('p');
  individualrating.className = 'restaurantdetail__individualreviewrating';
  const emptyStars = 5 - parseInt(review.rating);
  for (let i = 0; i < review.rating; i++) {
    const fullstar = document.createElement('img');
    fullstar.className = "restaurant__star restaurant__star--full";
    fullstar.src = "/img/fullstar.svg";
    fullstar.alt = "";
    individualrating.append(fullstar);
  }
  for (let i = 0; i < emptyStars; i++) {
    const emptystar = document.createElement('img');
    emptystar.className = "restaurant__star restaurant__star--empty";
    emptystar.src = "/img/emptystar.svg";
    emptystar.alt = "";
    individualrating.append(emptystar);
  }

  rightdiv.appendChild(individualrating);
  const date = document.createElement('p');
  date.className = 'restaurantdetail__reviewdate';
  const reviewdate = new Date(review.date);
  const todaydate = new Date();
  // Subtract todays date from the date of the review, then format into days
  const daysdifference = Math.round((todaydate - reviewdate) / 1000 / 60 / 60 / 24);
  date.innerHTML = `${daysdifference} ago`;
  rightdiv.appendChild(date);

  commentHeader.appendChild(rightdiv);
  li.appendChild(commentHeader);

  const comments = document.createElement('p');
  comments.innerHTML = review.comments;
  li.appendChild(comments);

  return li;
};

/**
 * Get a parameter by name from page URL.
 */
getParameterByName = (name, url) => {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),
        results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJteUNTUyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInJlbCIsImhyZWYiLCJoZWFkIiwiaW5zZXJ0QmVmb3JlIiwiY2hpbGROb2RlcyIsImxlbmd0aCIsIm5leHRTaWJsaW5nIiwicmVzdGF1cmFudCIsIm5ld01hcCIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZXMiLCJjb250cm9sbGVyIiwid2FpdGluZyIsIl91cGRhdGVSZWFkeSIsImluc3RhbGxpbmciLCJfdHJhY2tJbnN0YWxsaW5nIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwid29ya2VyIiwic3RhdGUiLCJmb2N1c2VkRWxlbWVudCIsImdldEVsZW1lbnRCeUlkIiwicG9zdE1lc3NhZ2UiLCJhY3Rpb24iLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJmb2N1cyIsImUiLCJrZXlDb2RlIiwic2hpZnRLZXkiLCJhY3RpdmVFbGVtZW50IiwiZmlyc3RUYWJTdG9wIiwicHJldmVudERlZmF1bHQiLCJsYXN0VGFiU3RvcCIsInRhYmluZGV4IiwiZm9jdXNhYmxlRWxlbWVudHNTdHJpbmciLCJmb2N1c2FibGVFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFkZCIsInF1ZXJ5U2VsZWN0b3IiLCJyZWZyZXNoaW5nIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJldmVudCIsImluaXRNYXAiLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwic2VsZiIsIkwiLCJtYXAiLCJjZW50ZXIiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwidGlsZUxheWVyIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJpZCIsImFkZFRvIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwibmFtZSIsImlubmVySFRNTCIsInJhdGluZyIsImVtcHR5U3RhcnMiLCJyYXRpbmdGb3JSZXN0YXVyYW50IiwiaSIsImZ1bGxzdGFyIiwiY2xhc3NOYW1lIiwic3JjIiwiYWx0IiwiYXBwZW5kIiwiZW1wdHlzdGFyIiwiYWRkcmVzcyIsImFkZHJlc3NpY29uIiwicHJlcGVuZCIsImltYWdlIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1hZ2VUZXh0Rm9yUmVzdGF1cmFudCIsInNyY3NldCIsImltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudCIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJjdWlzaW5laWNvbiIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiaG91cnMiLCJob3Vyc2ljb24iLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJ0aXRsZSIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImNvbW1lbnRIZWFkZXIiLCJsZWZ0ZGl2IiwiYXZhdGFyIiwicmlnaHRkaXYiLCJpbmRpdmlkdWFscmF0aW5nIiwicGFyc2VJbnQiLCJkYXRlIiwicmV2aWV3ZGF0ZSIsIkRhdGUiLCJ0b2RheWRhdGUiLCJkYXlzZGlmZmVyZW5jZSIsIk1hdGgiLCJyb3VuZCIsImNvbW1lbnRzIiwidXJsIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsSUFBSUEsUUFBUUMsU0FBU0MsYUFB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QVNkLFdBQVQsQ0FBcUJpQixJQUFyQjs7QUFFQU4sZ0JBQWNYLFdBQWQsQ0FBMEJjLFFBQTFCO0FBQ0FKLEtBQUdWLFdBQUgsQ0FBZVcsYUFBZjs7QUFFQSxRQUFNYSxXQUFXeEksU0FBU0MsYUFBVCxDQUF1QixHQUF2QixDQUFqQjtBQUNBdUksV0FBU3ZELFNBQVQsR0FBcUJ1QyxPQUFPZ0IsUUFBNUI7QUFDQWQsS0FBR1YsV0FBSCxDQUFld0IsUUFBZjs7QUFFQSxTQUFPZCxFQUFQO0FBQ0QsQ0E1REQ7O0FBOERBOzs7QUFHQTdDLHFCQUFxQixDQUFDRyxJQUFELEVBQU95RCxHQUFQLEtBQWU7QUFDbEMsTUFBSSxDQUFDQSxHQUFMLEVBQ0VBLE1BQU1wRixPQUFPQyxRQUFQLENBQWdCbkQsSUFBdEI7QUFDRjZFLFNBQU9BLEtBQUswRCxPQUFMLENBQWEsU0FBYixFQUF3QixNQUF4QixDQUFQO0FBQ0EsUUFBTUMsUUFBUSxJQUFJQyxNQUFKLENBQVksT0FBTTVELElBQUssbUJBQXZCLENBQWQ7QUFBQSxRQUNFNkQsVUFBVUYsTUFBTUcsSUFBTixDQUFXTCxHQUFYLENBRFo7QUFFQSxNQUFJLENBQUNJLE9BQUwsRUFDRSxPQUFPLElBQVA7QUFDRixNQUFJLENBQUNBLFFBQVEsQ0FBUixDQUFMLEVBQ0UsT0FBTyxFQUFQO0FBQ0YsU0FBT0UsbUJBQW1CRixRQUFRLENBQVIsRUFBV0gsT0FBWCxDQUFtQixLQUFuQixFQUEwQixHQUExQixDQUFuQixDQUFQO0FBQ0QsQ0FYRCIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDcmVhdGUgTGluayBFbGVtZW50IGZvciBTdHlsZXNoZWV0XG5sZXQgbXlDU1MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBcImxpbmtcIiApO1xubXlDU1MucmVsID0gXCJzdHlsZXNoZWV0XCI7XG5teUNTUy5ocmVmID0gXCIvY3NzL2xlYWZsZXQuY3NzXCI7XG4vLyBpbnNlcnQgaXQgYXQgdGhlIGVuZCBvZiB0aGUgaGVhZCBpbiBhIGxlZ2FjeS1mcmllbmRseSBtYW5uZXJcbmRvY3VtZW50LmhlYWQuaW5zZXJ0QmVmb3JlKCBteUNTUywgZG9jdW1lbnQuaGVhZC5jaGlsZE5vZGVzWyBkb2N1bWVudC5oZWFkLmNoaWxkTm9kZXMubGVuZ3RoIC0gMSBdLm5leHRTaWJsaW5nICk7IFxuXG5sZXQgcmVzdGF1cmFudDtcbnZhciBuZXdNYXA7XG5cbi8qKlxuICogQ2hlY2sgdG8gc2VlIGlmIHNlcnZpY2Ugd29ya2VyIGlzIHN1cHBvcnRlZCBieSB0aGUgYnJvd3NlciBcbiAqL1xuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgXG4gIC8qIGlmIGl0IGlzLCByZWdpc3RlciB0aGUgc2VydmljZSB3b3JrZXIgKi9cbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24ocmVzKXtcblxuICAgIC8vIEFscmVhZHkgb24gdGhlIGxhdGVzdCB2ZXJzaW9uLCBiYWlsXG4gICAgaWYoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhIHdhaXRpbmcgc2VydmljZSB3b3JrZXJcbiAgICBpZiAocmVzLndhaXRpbmcpe1xuICAgICAgX3VwZGF0ZVJlYWR5KCk7XG4gICAgICByZXR1cm4gXG4gICAgfVxuXG4gICAgaWYgKHJlcy5pbnN0YWxsaW5nKSB7XG4gICAgICBfdHJhY2tJbnN0YWxsaW5nKHJlcy5pbnN0YWxsaW5nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgcmVzLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICBfdHJhY2tJbnN0YWxsaW5nKHJlcy5pbnN0YWxsaW5nKTtcbiAgICB9KTtcbiAgICBcbiAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuICAgIGNvbnNvbGUubG9nKCdlcnJvciByZWdpc3RlcmluZyBzZXJ2aWNlIHdvcmtlcjogJyxlcnJvcilcbiAgfSk7XG4gIFxuICBmdW5jdGlvbiBfdHJhY2tJbnN0YWxsaW5nKHdvcmtlcil7XG4gICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpe1xuICAgICAgaWYgKHdvcmtlci5zdGF0ZSA9PSAnaW5zdGFsbGVkJyl7XG4gICAgICAgIF91cGRhdGVSZWFkeSh3b3JrZXIpO1xuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICB2YXIgZm9jdXNlZEVsZW1lbnQ7XG4gIC8qKlxuICAgKiBOb3RpZmllcyB0aGUgdXNlciB0aGF0IGFuIHVwZGF0ZWQgU1cgaXMgYXZhaWxhYmxlXG4gICAqL1xuICBmdW5jdGlvbiBfdXBkYXRlUmVhZHkod29ya2VyKXtcbiAgICAvLyBJZiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIHVwZGF0ZSBidXR0b24sIHVwZGF0ZSB0aGUgc2VydmljZSB3b3JrZXJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBkYXRlLXZlcnNpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oKXtcbiAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7YWN0aW9uOidza2lwV2FpdGluZyd9KTtcbiAgICB9KTtcbiAgICAvLyBJZiB0aGUgdXNlciBjbGlja3MgdGhlIGRpc21pc3MgYnV0dG9uLCBoaWRlIHRoZSB0b2FzdFxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNtaXNzLXZlcnNpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oKXtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgZm9jdXNlZEVsZW1lbnQuZm9jdXMoKVxuICAgIH0pO1xuICAgIC8vIElmIHRoZSB0b2FzdCBpcyBkaXNwbGF5aW5nLCBsaXN0ZW4gZm9yIGtleWJvYXJkIGV2ZW50c1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLGZ1bmN0aW9uKGUpe1xuICAgICAgLy9DaGVjayBmb3IgVGFiIGtleSBwcmVzc1xuICAgICAgaWYoZS5rZXlDb2RlID09PSA5KXtcbiAgICAgICAgXG4gICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgLy9QcmVzc2VkIFNoaWZ0IFRhYlxuICAgICAgICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGZpcnN0VGFiU3RvcCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgbGFzdFRhYlN0b3AuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIC8vUHJlc3NlZCBUYWJcbiAgICAgICAgICBpZihkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBsYXN0VGFiU3RvcCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZmlyc3RUYWJTdG9wLmZvY3VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBFc2NhcGUgS2V5XG4gICAgICBpZiAoZS5rZXlDb2RlID09PSAyNyl7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICBmb2N1c2VkRWxlbWVudC5mb2N1cygpXG4gICAgICB9IFxuICAgIH0pO1xuXG4gICAgLy8gUmVtZW1iZXIgd2hhdCB0aGUgbGFzdCBlbGVtZW50IHRoYXQgd2FzIGZvY3VzZWQgd2FzLCBhbmQgbWFrZSBpdCBmb2N1c2FibGUgc28gd2UgY2FuIHJldHVybiB0byBpdFxuICAgIGZvY3VzZWRFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICBmb2N1c2VkRWxlbWVudC50YWJpbmRleCA9IDE7XG4gICBcbiAgICAvLyBXaGVuIHRoZSB0b2FzdCBpcyB2aXNpYmxlLCB0aGlzIGlzIHdoYXQgd2UnbGwgdXNlIHRvIHRlbXBvcmFyaWx5IHRyYXAgZm9jdXNcbiAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcgPSAnI3RvYXN0IHAsICN1cGRhdGUtdmVyc2lvbiwgI2Rpc21pc3MtdmVyc2lvbic7XG4gICAgdmFyIGZvY3VzYWJsZUVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChmb2N1c2FibGVFbGVtZW50c1N0cmluZyk7XG4gICAgZm9jdXNhYmxlRWxlbWVudHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmb2N1c2FibGVFbGVtZW50cyk7XG4gICAgXG4gICAgdmFyIGZpcnN0VGFiU3RvcCA9IGZvY3VzYWJsZUVsZW1lbnRzWzBdO1xuICAgIHZhciBsYXN0VGFiU3RvcCA9IGZvY3VzYWJsZUVsZW1lbnRzW2ZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAtMV07XG5cbiAgICAvLyBPayB0aW1lIHRvIHNob3cgdGhlIHRvYXN0IGFuZCBmb2N1cyBvbiBpdFxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2FzdCBwJykuZm9jdXMoKTtcblxuICB9XG4gIFxuXG4gIC8qKlxuICAgKiBMaXN0ZW5zIGZvciBhIGNoYW5nZSBpbiB0aGUgU1csIHJlbG9hZHMgdGhlIHBhZ2UgYXMgYSByZXN1bHRcbiAgICovXG4gIHZhciByZWZyZXNoaW5nO1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coJ2NvbnRyb2xsZXIgY2hhbmdlJylcbiAgICBpZiAocmVmcmVzaGluZykgcmV0dXJuO1xuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICByZWZyZXNoaW5nID0gdHJ1ZTtcbiAgfSk7XG59XG5cblxuXG4vKipcbiAgKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4geyAgXG4gIGluaXRNYXAoKTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcFxuICAgKi9cbiAgaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHsgICAgICBcbiAgICAgIHNlbGYubmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xuICAgICAgICBtYXBib3hUb2tlbjogJ3BrLmV5SjFJam9pWm1GeWNtVnNiSE5qY21sd2RDSXNJbUVpT2lKamFtSmlhVGwzZEhNeE9HeHNNekp3WlRsbVluTjRaSE41SW4wLjZFeTUwZWwwYXR3akR5Z09fY08wc0EnLFxuICAgICAgICBtYXhab29tOiAxOCxcbiAgICAgICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXG4gICAgICAgICAgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJyArXG4gICAgICAgICAgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgICAgIGlkOiAnbWFwYm94LnN0cmVldHMnICAgIFxuICAgICAgfSkuYWRkVG8obmV3TWFwKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgfVxuICB9KTtcbiAgfSAgXG4gIFxuICAvKiB3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgfSAqL1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIC8vIFJldmlldyBvZiB0aGUgcmVzdGF1cmFudFxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJyk7XG4gIGNvbnN0IGVtcHR5U3RhcnMgPSA1IC0gREJIZWxwZXIucmF0aW5nRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgZm9yKGxldCBpPTA7IGkgPCBEQkhlbHBlci5yYXRpbmdGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpOyBpKyspe1xuICAgIGNvbnN0IGZ1bGxzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgZnVsbHN0YXIuY2xhc3NOYW1lPVwicmVzdGF1cmFudF9fc3RhciByZXN0YXVyYW50X19zdGFyLS1mdWxsXCI7XG4gICAgZnVsbHN0YXIuc3JjID0gXCIvaW1nL2Z1bGxzdGFyLnN2Z1wiO1xuICAgIGZ1bGxzdGFyLmFsdCA9IFwiXCJcbiAgICByYXRpbmcuYXBwZW5kKGZ1bGxzdGFyKTtcbiAgfVxuICBmb3IobGV0IGk9MDsgaSA8IGVtcHR5U3RhcnM7IGkrKyl7XG4gICAgY29uc3QgZW1wdHlzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgZW1wdHlzdGFyLmNsYXNzTmFtZT1cInJlc3RhdXJhbnRfX3N0YXIgcmVzdGF1cmFudF9fc3Rhci0tZW1wdHlcIjtcbiAgICBlbXB0eXN0YXIuc3JjID0gXCIvaW1nL2VtcHR5c3Rhci5zdmdcIjtcbiAgICBlbXB0eXN0YXIuYWx0PSBcIlwiXG4gICAgcmF0aW5nLmFwcGVuZChlbXB0eXN0YXIpO1xuICB9XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgYWRkcmVzc2ljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgYWRkcmVzc2ljb24uY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRkZXRhaWxfX2ljb24nO1xuICBhZGRyZXNzaWNvbi5zcmMgPSAnL2ltZy93YXlwb2ludC5zdmcnO1xuICBhZGRyZXNzaWNvbi5hbHQgPSAnJztcbiAgYWRkcmVzcy5wcmVwZW5kKGFkZHJlc3NpY29uKVxuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5pbWFnZVRleHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICBjb25zdCBjdWlzaW5laWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBjdWlzaW5laWNvbi5jbGFzc05hbWUgPSAncmVzdGF1cmFudGRldGFpbF9faWNvbic7XG4gIGN1aXNpbmVpY29uLnNyYyA9ICcvaW1nL2N1aXNpbmUuc3ZnJztcbiAgY3Vpc2luZWljb24uYWx0ID0gJyc7XG4gIGN1aXNpbmUucHJlcGVuZChjdWlzaW5laWNvbilcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuXG4gICAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudGRldGFpbF9faG91cnNjb250YWluZXInKTtcbiAgXG4gICAgY29uc3QgaG91cnNpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgaG91cnNpY29uLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50ZGV0YWlsX19pY29uJztcbiAgICBob3Vyc2ljb24uc3JjID0gJy9pbWcvY2xvY2suc3ZnJztcbiAgICBob3Vyc2ljb24uYWx0ID0gJyc7XG4gICAgaG91cnMucHJlcGVuZChob3Vyc2ljb24pXG5cbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50ZGV0YWlsX19kYXknO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50ZGV0YWlsX19ob3VyJztcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIHRpdGxlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50ZGV0YWlsX19yZXZpZXdzdGl0bGUnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5jbGFzc05hbWUgPSAncmVzdGF1cmFudGRldGFpbF9fcmV2aWV3JztcbiAgY29uc3QgY29tbWVudEhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBjb21tZW50SGVhZGVyLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50ZGV0YWlsX19jb21tZW50aGVhZGVyJztcblxuICBjb25zdCBsZWZ0ZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGxlZnRkaXYuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRkZXRhaWxfX2F2YXRhcmNvbnRhaW5lcic7XG5cbiAgY29uc3QgYXZhdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGF2YXRhci5zcmMgID0gJy9pbWcvYXZhdGFyLnN2Zyc7XG4gIGF2YXRhci5jbGFzc05hbWUgPSAncmVzdGF1cmFudGRldGFpbF9fYXZhdGFyJztcbiAgYXZhdGFyLmFsdCA9ICdBdmF0YXIgcGhvdG8nO1xuICBsZWZ0ZGl2LmFwcGVuZENoaWxkKGF2YXRhcik7XG4gIGNvbW1lbnRIZWFkZXIuYXBwZW5kQ2hpbGQobGVmdGRpdik7XG5cbiAgY29uc3QgcmlnaHRkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgcmlnaHRkaXYuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRkZXRhaWxfX25hbWVjb250YWluZXInO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIHJpZ2h0ZGl2LmFwcGVuZENoaWxkKG5hbWUpO1xuICBcbiAgLy8gQ3JlYXRlIFN0YXJzIGZvciBSZXZpZXdcbiAgY29uc3QgaW5kaXZpZHVhbHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgaW5kaXZpZHVhbHJhdGluZy5jbGFzc05hbWUgPSAncmVzdGF1cmFudGRldGFpbF9faW5kaXZpZHVhbHJldmlld3JhdGluZyc7XG4gIGNvbnN0IGVtcHR5U3RhcnMgPSA1IC0gcGFyc2VJbnQocmV2aWV3LnJhdGluZyk7XG4gIGZvcihsZXQgaT0wOyBpIDwgcmV2aWV3LnJhdGluZzsgaSsrKXtcbiAgICBjb25zdCBmdWxsc3RhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgIGZ1bGxzdGFyLmNsYXNzTmFtZT1cInJlc3RhdXJhbnRfX3N0YXIgcmVzdGF1cmFudF9fc3Rhci0tZnVsbFwiO1xuICAgIGZ1bGxzdGFyLnNyYyA9IFwiL2ltZy9mdWxsc3Rhci5zdmdcIjtcbiAgICBmdWxsc3Rhci5hbHQgPSBcIlwiXG4gICAgaW5kaXZpZHVhbHJhdGluZy5hcHBlbmQoZnVsbHN0YXIpO1xuICB9XG4gIGZvcihsZXQgaT0wOyBpIDwgZW1wdHlTdGFyczsgaSsrKXtcbiAgICBjb25zdCBlbXB0eXN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICBlbXB0eXN0YXIuY2xhc3NOYW1lPVwicmVzdGF1cmFudF9fc3RhciByZXN0YXVyYW50X19zdGFyLS1lbXB0eVwiO1xuICAgIGVtcHR5c3Rhci5zcmMgPSBcIi9pbWcvZW1wdHlzdGFyLnN2Z1wiO1xuICAgIGVtcHR5c3Rhci5hbHQ9IFwiXCJcbiAgICBpbmRpdmlkdWFscmF0aW5nLmFwcGVuZChlbXB0eXN0YXIpO1xuICB9XG5cbiAgcmlnaHRkaXYuYXBwZW5kQ2hpbGQoaW5kaXZpZHVhbHJhdGluZyk7XG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRkZXRhaWxfX3Jldmlld2RhdGUnXG4gIGNvbnN0IHJldmlld2RhdGUgPSBuZXcgRGF0ZShyZXZpZXcuZGF0ZSk7XG4gIGNvbnN0IHRvZGF5ZGF0ZSA9IG5ldyBEYXRlKCk7XG4gIC8vIFN1YnRyYWN0IHRvZGF5cyBkYXRlIGZyb20gdGhlIGRhdGUgb2YgdGhlIHJldmlldywgdGhlbiBmb3JtYXQgaW50byBkYXlzXG4gIGNvbnN0IGRheXNkaWZmZXJlbmNlID0gTWF0aC5yb3VuZCgodG9kYXlkYXRlIC0gcmV2aWV3ZGF0ZSkvMTAwMC82MC82MC8yNClcbiAgZGF0ZS5pbm5lckhUTUwgPSBgJHtkYXlzZGlmZmVyZW5jZX0gYWdvYDtcbiAgcmlnaHRkaXYuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29tbWVudEhlYWRlci5hcHBlbmRDaGlsZChyaWdodGRpdik7IFxuICBsaS5hcHBlbmRDaGlsZChjb21tZW50SGVhZGVyKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKVxuICAgIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pXG4gICAgcmV0dXJuICcnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufVxuIl19
