let restaurant;var newMap;if("serviceWorker"in navigator){function _trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&_updateReady(e)})}var focusedElement,refreshing;function _updateReady(e){document.getElementById("update-version").addEventListener("click",function(){e.postMessage({action:"skipWaiting"})}),document.getElementById("dismiss-version").addEventListener("click",function(){document.getElementById("toast").classList.remove("active"),focusedElement.focus()}),document.getElementById("toast").addEventListener("keydown",function(e){9===e.keyCode&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),n.focus())),27===e.keyCode&&(document.getElementById("toast").classList.remove("active"),focusedElement.focus())}),(focusedElement=document.activeElement).tabindex=1;var t=document.querySelectorAll("#toast p, #update-version, #dismiss-version"),n=(t=Array.prototype.slice.call(t))[0],r=t[t.length-1];document.getElementById("toast").classList.add("active"),document.querySelector("#toast p").focus()}navigator.serviceWorker.register("/sw.js").then(function(e){navigator.serviceWorker.controller&&(e.waiting?_updateReady():e.installing?_trackInstalling(e.installing):e.addEventListener("updatefound",function(){_trackInstalling(e.installing)}))}).catch(function(e){console.log("error registering service worker: ",e)}),navigator.serviceWorker.addEventListener("controllerchange",function(){console.log("controller change"),refreshing||(window.location.reload(),refreshing=!0)})}document.addEventListener("DOMContentLoaded",e=>{initMap()}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"<your MAPBOX API KEY HERE>",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt=DBHelper.imageTextForRestaurant(e),t.srcset=DBHelper.imageSrcSetForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=e.date,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-current","page"),n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwibmF2aWdhdG9yIiwid29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl91cGRhdGVSZWFkeSIsImZvY3VzZWRFbGVtZW50IiwicmVmcmVzaGluZyIsInBvc3RNZXNzYWdlIiwiYWN0aW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImZvY3VzIiwiZSIsImtleUNvZGUiLCJzaGlmdEtleSIsInByZXZlbnREZWZhdWx0IiwiZmlyc3RUYWJTdG9wIiwibGFzdFRhYlN0b3AiLCJ0YWJpbmRleCIsImFjdGl2ZUVsZW1lbnQiLCJmb2N1c2FibGVFbGVtZW50cyIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJjYWxsIiwibGVuZ3RoIiwicXVlcnlTZWxlY3RvciIsImFkZCIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZXMiLCJjb250cm9sbGVyIiwid2FpdGluZyIsImluc3RhbGxpbmciLCJfdHJhY2tJbnN0YWxsaW5nIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJldmVudCIsImluaXRNYXAiLCJzZWxmIiwiY2VudGVyIiwiem9vbSIsIkwiLCJtYXAiLCJ0aWxlTGF5ZXIiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJtYXBib3hUb2tlbiIsIm1heFpvb20iLCJpZCIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkVG8iLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiY2FsbGJhY2siLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsIm5hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJpbWFnZSIsInNyY3NldCIsImltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudCIsImNsYXNzTmFtZSIsImN1aXNpbmUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJjcmVhdGVFbGVtZW50IiwiZGF5Iiwicm93IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwia2V5IiwiY29udGFpbmVyIiwicmV2aWV3cyIsInRpdGxlIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsInNldEF0dHJpYnV0ZSIsInJlZ2V4IiwidXJsIiwicmVzdWx0cyIsImhyZWYiLCJkZWNvZGVVUklDb21wb25lbnQiLCJSZWdFeHAiLCJleGVjIiwicmVwbGFjZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FDSixJQUFJQyxPQUtKLEdBQUksa0JBQW1CQyxVQUFXLENBNkI5QkMsU0FBT0MsaUJBQWlCRCxHQUN0QkEsRUFBSUEsaUJBQWdCLGNBQVksV0FDakJBLGFBQWJFLEVBQUFBLE9BQ0RBLGFBQUFGLEtBS0wsSUFBQUcsZUFnRUVDLFdBNURBLFNBQUFGLGFBQUFGLEdBRUVBLFNBQU9LLGVBQWFDLGtCQUFPTCxpQkFBM0IsUUFBQSxXQURGRCxFQUFBSyxhQUFBQyxPQUFBLGtCQUtFQyxTQUFBQSxlQUFTQyxtQkFBd0JDLGlCQUFqQyxRQUFBLFdBQ0FOLFNBQUFBLGVBQUEsU0FBQU0sVUFBQUMsT0FBQSxVQUZGUCxlQUFBUSxVQU1FSixTQUFBQyxlQUFBLFNBQUFQLGlCQUFBLFVBQUEsU0FBQVcsR0FDaUIsSUFBZEEsRUFBRUMsVUFHREQsRUFBQUUsU0FFRUYsU0FBRUcsZ0JBQUZDLElBQ0FDLEVBQUFBLGlCQUNEQSxFQUFBTixTQUlDQyxTQUFFRyxnQkFBRkUsSUFDQUQsRUFBQUEs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RCxTQUNTK0QsTUFDVHBDLEVBQU9xQyxFQUFBQSxRQUFBQSxVQUFtQkYsUUFWNUIsTUFLSUEsRUFMSixJQUFBRyxjQUFBdEMsc0JBS29CdUMsS0FBS0wsR0FDdkIsT0FBS0MsRUFFQUEsRUFBUSxHQUVORSxtQkFBbUJGLEVBQVEsR0FBR0ssUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XG52YXIgbmV3TWFwO1xuXG4vKipcbiAqIENoZWNrIHRvIHNlZSBpZiBzZXJ2aWNlIHdvcmtlciBpcyBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIgXG4gKi9cbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4gIFxuICAvKiBpZiBpdCBpcywgcmVnaXN0ZXIgdGhlIHNlcnZpY2Ugd29ya2VyICovXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uKHJlcyl7XG5cbiAgICAvLyBBbHJlYWR5IG9uIHRoZSBsYXRlc3QgdmVyc2lvbiwgYmFpbFxuICAgIGlmKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZXJlJ3MgYSB3YWl0aW5nIHNlcnZpY2Ugd29ya2VyXG4gICAgaWYgKHJlcy53YWl0aW5nKXtcbiAgICAgIF91cGRhdGVSZWFkeSgpO1xuICAgICAgcmV0dXJuIFxuICAgIH1cblxuICAgIGlmIChyZXMuaW5zdGFsbGluZykge1xuICAgICAgX3RyYWNrSW5zdGFsbGluZyhyZXMuaW5zdGFsbGluZyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIHJlcy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgX3RyYWNrSW5zdGFsbGluZyhyZXMuaW5zdGFsbGluZyk7XG4gICAgfSk7XG4gICAgXG4gIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcbiAgICBjb25zb2xlLmxvZygnZXJyb3IgcmVnaXN0ZXJpbmcgc2VydmljZSB3b3JrZXI6ICcsZXJyb3IpXG4gIH0pO1xuICBcbiAgZnVuY3Rpb24gX3RyYWNrSW5zdGFsbGluZyh3b3JrZXIpe1xuICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsZnVuY3Rpb24oKXtcbiAgICAgIGlmICh3b3JrZXIuc3RhdGUgPT0gJ2luc3RhbGxlZCcpe1xuICAgICAgICBfdXBkYXRlUmVhZHkod29ya2VyKTtcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgdmFyIGZvY3VzZWRFbGVtZW50O1xuICAvKipcbiAgICogTm90aWZpZXMgdGhlIHVzZXIgdGhhdCBhbiB1cGRhdGVkIFNXIGlzIGF2YWlsYWJsZVxuICAgKi9cbiAgZnVuY3Rpb24gX3VwZGF0ZVJlYWR5KHdvcmtlcil7XG4gICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSB1cGRhdGUgYnV0dG9uLCB1cGRhdGUgdGhlIHNlcnZpY2Ugd29ya2VyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwZGF0ZS12ZXJzaW9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKCl7XG4gICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe2FjdGlvbjonc2tpcFdhaXRpbmcnfSk7XG4gICAgfSk7XG4gICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIHRoZSBkaXNtaXNzIGJ1dHRvbiwgaGlkZSB0aGUgdG9hc3RcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzbWlzcy12ZXJzaW9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKCl7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgIGZvY3VzZWRFbGVtZW50LmZvY3VzKClcbiAgICB9KTtcbiAgICAvLyBJZiB0aGUgdG9hc3QgaXMgZGlzcGxheWluZywgbGlzdGVuIGZvciBrZXlib2FyZCBldmVudHNcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJyxmdW5jdGlvbihlKXtcbiAgICAgIC8vQ2hlY2sgZm9yIFRhYiBrZXkgcHJlc3NcbiAgICAgIGlmKGUua2V5Q29kZSA9PT0gOSl7XG4gICAgICAgIFxuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgIC8vUHJlc3NlZCBTaGlmdCBUYWJcbiAgICAgICAgICBpZihkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBmaXJzdFRhYlN0b3ApIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGxhc3RUYWJTdG9wLmZvY3VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAvL1ByZXNzZWQgVGFiXG4gICAgICAgICAgaWYoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gbGFzdFRhYlN0b3ApIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGZpcnN0VGFiU3RvcC5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gRXNjYXBlIEtleVxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpe1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgZm9jdXNlZEVsZW1lbnQuZm9jdXMoKVxuICAgICAgfSBcbiAgICB9KTtcblxuICAgIC8vIFJlbWVtYmVyIHdoYXQgdGhlIGxhc3QgZWxlbWVudCB0aGF0IHdhcyBmb2N1c2VkIHdhcywgYW5kIG1ha2UgaXQgZm9jdXNhYmxlIHNvIHdlIGNhbiByZXR1cm4gdG8gaXRcbiAgICBmb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgZm9jdXNlZEVsZW1lbnQudGFiaW5kZXggPSAxO1xuICAgXG4gICAgLy8gV2hlbiB0aGUgdG9hc3QgaXMgdmlzaWJsZSwgdGhpcyBpcyB3aGF0IHdlJ2xsIHVzZSB0byB0ZW1wb3JhcmlseSB0cmFwIGZvY3VzXG4gICAgdmFyIGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nID0gJyN0b2FzdCBwLCAjdXBkYXRlLXZlcnNpb24sICNkaXNtaXNzLXZlcnNpb24nO1xuICAgIHZhciBmb2N1c2FibGVFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcpO1xuICAgIGZvY3VzYWJsZUVsZW1lbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZm9jdXNhYmxlRWxlbWVudHMpO1xuICAgIFxuICAgIHZhciBmaXJzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1swXTtcbiAgICB2YXIgbGFzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1tmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLTFdO1xuXG4gICAgLy8gT2sgdGltZSB0byBzaG93IHRoZSB0b2FzdCBhbmQgZm9jdXMgb24gaXRcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9hc3QgcCcpLmZvY3VzKCk7XG5cbiAgfVxuICBcblxuICAvKipcbiAgICogTGlzdGVucyBmb3IgYSBjaGFuZ2UgaW4gdGhlIFNXLCByZWxvYWRzIHRoZSBwYWdlIGFzIGEgcmVzdWx0XG4gICAqL1xuICB2YXIgcmVmcmVzaGluZztcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKCdjb250cm9sbGVyIGNoYW5nZScpXG4gICAgaWYgKHJlZnJlc2hpbmcpIHJldHVybjtcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgcmVmcmVzaGluZyA9IHRydWU7XG4gIH0pO1xufVxuXG5cblxuLyoqXG4gICogSW5pdGlhbGl6ZSBtYXAgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHsgIFxuICBpbml0TWFwKCk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAgICovXG4gIGluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7ICAgICAgXG4gICAgICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XG4gICAgICAgIGNlbnRlcjogW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICAgICAgbWFwYm94VG9rZW46ICc8eW91ciBNQVBCT1ggQVBJIEtFWSBIRVJFPicsXG4gICAgICAgIG1heFpvb206IDE4LFxuICAgICAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnICtcbiAgICAgICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcbiAgICAgICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICAgICAgaWQ6ICdtYXBib3guc3RyZWV0cycgICAgXG4gICAgICB9KS5hZGRUbyhuZXdNYXApO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgfVxuICB9KTtcbiAgfSAgXG4gIFxuICAvKiB3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgfSAqL1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5pbWFnZVRleHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50JywncGFnZScpXG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG4iXX0=
