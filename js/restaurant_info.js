let myCSS=document.createElement("link");myCSS.rel="stylesheet",myCSS.href="/css/leaflet.css",document.head.insertBefore(myCSS,document.head.childNodes[document.head.childNodes.length-1].nextSibling);const dbWorker=new Worker("./js/dbworker.js");let restaurant;var newMap;initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZmFycmVsbHNjcmlwdCIsImEiOiJjamJiaTl3dHMxOGxsMzJwZTlmYnN4ZHN5In0.6Ey50el0atwjDygO_cO0sA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),mapMarkerForRestaurant(t,self.newMap))})}),mapMarkerForRestaurant=((e,t)=>{const a=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name});return a.addTo(newMap),a}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?(dbWorker.addEventListener("message",function(t){"error"==t.data?console.error(t.data):(console.log("got back: ",t.data.restaurant),t.data.restaurant&&(fillRestaurantHTML(t.data.restaurant,t.data.reviews),e(null,t.data.restaurant)))},!1),dbWorker.postMessage({action:"fetchRestaurantById",id:t})):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e,t)=>{console.log("restaurant",e),document.getElementById("restaurantdetail__id").value=e.id,document.getElementById("restaurant-name").innerHTML=e.name;const a=document.getElementById("rating");let r=5-t;for(let e=0;e<t;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--full",e.src="/img/fullstar.svg",e.alt="",a.append(e)}for(let e=0;e<r;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--empty",e.src="/img/emptystar.svg",e.alt="",a.append(e)}const n=document.getElementById("restaurant-address");n.innerHTML=e.address;const s=document.createElement("img");s.className="restaurantdetail__icon",s.src="/img/waypoint.svg",s.alt="",n.prepend(s);const l=document.getElementById("restaurant-img");l.className="restaurant-img",l.src=DBHelper.imageUrlForRestaurant(e),l.alt=DBHelper.imageTextForRestaurant(e),l.srcset=DBHelper.imageSrcSetForRestaurant(e);const i=document.getElementById("restaurant-cuisine");i.innerHTML=e.cuisine_type;const o=document.createElement("img");if(o.className="restaurantdetail__icon",o.src="/img/cuisine.svg",o.alt="",i.prepend(o),e.operating_hours){fillRestaurantHoursHTML(e.operating_hours);const t=document.getElementById("restaurantdetail__hourscontainer"),a=document.createElement("img");a.className="restaurantdetail__icon",a.src="/img/clock.svg",a.alt="",t.prepend(a)}dbWorker.addEventListener("message",function(e){"error"==e.data?console.error(e.data):(console.log("got back: ",e.data.reviews),fillReviewsHTML(e.data.reviews))},!1),dbWorker.postMessage({action:"fillReviewsHTML",id:e.id})}),fillRestaurantHoursHTML=(e=>{const t=document.getElementById("restaurant-hours");for(let a in e){const r=document.createElement("tr"),n=document.createElement("td");n.className="restaurantdetail__day",n.innerHTML=a,r.appendChild(n);const s=document.createElement("td");s.className="restaurantdetail__hour",s.innerHTML=e[a],r.appendChild(s),t.appendChild(r)}}),fillReviewsHTML=(e=>{const t=document.getElementById("reviews-container");if(!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const a=document.getElementById("reviews-list");a.innerHTML="",e.reverse().forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a)}),createReviewHTML=(e=>{const t=document.createElement("li");t.className="restaurantdetail__review";const a=document.createElement("div");a.className="restaurantdetail__commentheader";const r=document.createElement("div");r.className="restaurantdetail__avatarcontainer";const n=document.createElement("img");n.src="/img/avatar.svg",n.className="restaurantdetail__avatar",n.alt="Avatar photo",r.appendChild(n),a.appendChild(r);const s=document.createElement("div");s.className="restaurantdetail__namecontainer";const l=document.createElement("p");l.innerHTML=e.name,s.appendChild(l);const i=document.createElement("p");i.className="restaurantdetail__individualreviewrating";const o=5-parseInt(e.rating);for(let t=0;t<e.rating;t++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--full",e.src="/img/fullstar.svg",e.alt="",i.append(e)}for(let e=0;e<o;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--empty",e.src="/img/emptystar.svg",e.alt="",i.append(e)}s.appendChild(i);const d=document.createElement("p");d.className="restaurantdetail__reviewdate";const c=new Date(e.createdAt),u=new Date,m=Math.round((u-c)/1e3/60/60/24);d.innerHTML=`${m} days ago`,s.appendChild(d),a.appendChild(s),t.appendChild(a);const p=document.createElement("p");return p.innerHTML=e.comments,t.appendChild(p),t}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}),document.querySelector(".restaurantdetail__reviewinput").addEventListener("focus",function(){this.previousElementSibling.classList.add("restaurantdetail__reviewlabel--active")}),document.querySelector(".restaurantdetail__reviewinput").addEventListener("blur",function(){""===this.value&&this.previousElementSibling.classList.remove("restaurantdetail__reviewlabel--active")}),document.querySelector(".restaurantdetail__reviewnameinput").addEventListener("focus",function(){this.previousElementSibling.classList.add("restaurantdetail__reviewnamelabel--active")}),document.querySelector(".restaurantdetail__reviewnameinput").addEventListener("blur",function(){""===this.value&&this.previousElementSibling.classList.remove("restaurantdetail__reviewnamelabel--active")}),document.querySelector(".restaurantdetails__reviewform").addEventListener("submit",function(e){e.preventDefault();let t=document.querySelector(".restaurantdetail__id").value,a=document.querySelector(".restaurantdetail__star--selected").getAttribute("data-value"),r=document.querySelector(".restaurantdetail__reviewnameinput").value,n=document.querySelector(".restaurantdetail__reviewinput").value,s={restaurant_id:parseInt(t),name:r,rating:parseInt(a),comments:n,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime()};fetch("http://localhost:1337/reviews/",{method:"post",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{dbWorker.postMessage({action:"fillReviewsHTML",id:t})})});const hoverlinks=document.querySelectorAll(".restaurantdetail__star");for(var i=0;i<hoverlinks.length;i++)hoverlinks[i].addEventListener("click",function(e){const t=document.querySelectorAll(".restaurantdetail__star"),a=this.getAttribute("data-value");for(var r=1;r<=t.length;r++)document.querySelector(`.restaurantdetail__star[data-value="${r}"]`).classList.remove("restaurantdetail__star--selected"),r<=a?document.querySelector(`.restaurantdetail__star[data-value="${r}"]`).classList.add("restaurantdetail__star--active"):document.querySelector(`.restaurantdetail__star[data-value="${r}"]`).classList.remove("restaurantdetail__star--active");document.querySelector(`.restaurantdetail__star[data-value="${a}"]`).classList.add("restaurantdetail__star--selected")});setTimeout(()=>{initMap()},100);