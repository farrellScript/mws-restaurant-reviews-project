let restaurants,neighborhoods,cuisines;var newMap,markers=[];document.addEventListener("DOMContentLoaded",e=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZmFycmVsbHNjcmlwdCIsImEiOiJjamJiaTl3dHMxOGxsMzJwZTlmYnN4ZHN5In0.6Ey50el0atwjDygO_cO0sA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,s=t.selectedIndex,n=e[a].value,r=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,r,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.className="restaurant__container";const a=document.createElement("img");a.className="restaurant__image",a.alt=DBHelper.imageTextForRestaurant(e),a.srcset=DBHelper.imageSrcSetForRestaurant(e),a.src=DBHelper.imageUrlForRestaurant(e),t.append(a);const s=document.createElement("div");s.className="restaurant__textcontainer";const n=document.createElement("h2");n.className="restaurant__name",n.innerHTML=e.name,s.append(n);const r=document.createElement("div");r.className="restaurant__reviewcontainer";const o=5-DBHelper.ratingForRestaurant(e);for(let t=0;t<DBHelper.ratingForRestaurant(e);t++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--full",e.src="/img/fullstar.svg",e.alt="",r.append(e)}for(let e=0;e<o;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--empty",e.src="/img/emptystar.svg",e.alt="",r.append(e)}s.append(r);const l=document.createElement("p");l.className="restaurant__cuisine",l.innerHTML=e.cuisine_type,s.append(l);const c=document.createElement("p");c.className="restaurant__neighborhood",c.innerHTML=e.neighborhood,s.append(c);const i=document.createElement("hr");i.className="restaurant__hr",s.append(i);const u=document.createElement("p");u.className="restaurant__address",u.innerHTML=e.address,s.append(u);const m=document.createElement("a");return m.className="restaurant__link",m.innerHTML=DBHelper.urlTextForRestaurant(e),m.href=DBHelper.urlForRestaurant(e),s.append(m),t.append(s),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url})})}),document.getElementById("neighborhoods-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("neighborhoods-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJtYXJrZXJzIiwiZmV0Y2hDdWlzaW5lcyIsImluaXRNYXAiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJjb25zb2xlIiwiZXJyb3IiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwibmVpZ2hib3Job29kIiwic2VsZWN0Iiwib3B0aW9uIiwiZG9jdW1lbnQiLCJpbm5lckhUTUwiLCJhcHBlbmQiLCJ2YWx1ZSIsIkRCSGVscGVyIiwiZmlsbEN1aXNpbmVzSFRNTCIsImdldEVsZW1lbnRCeUlkIiwiY3Vpc2luZSIsImNlbnRlciIsIkwiLCJtYXAiLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJpZCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiYWRkVG8iLCJjU2VsZWN0IiwibkluZGV4IiwiblNlbGVjdCIsInNlbGVjdGVkSW5kZXgiLCJjSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsImZvckVhY2giLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsInJlc3RhdXJhbnQiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJpbWFnZSIsInNyY3NldCIsImltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudCIsInNyYyIsImltYWdlVGV4dEZvclJlc3RhdXJhbnQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsb3dlcmNvbnRhaW5lciIsIm5hbWUiLCJyYXRpbmciLCJyYXRpbmdGb3JSZXN0YXVyYW50IiwiZnVsbHN0YXIiLCJpIiwiZW1wdHlzdGFyIiwiZW1wdHlTdGFycyIsImN1aXNpbmVfdHlwZSIsImhyIiwiYWRkcmVzcyIsIm1vcmUiLCJ1cmxUZXh0Rm9yUmVzdGF1cmFudCIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50Iiwib25DbGljayIsIndpbmRvdyIsImxvY2F0aW9uIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsIm9uIiwib3B0aW9ucyIsInVybCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0aGlzIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsWUFHSkMsY0FDQUMsU0FEQSxJQUFJQyxPQUdKQyxXQXVIRUMsU0FBQUEsaUJBQUFBLG1CQUFBQSxJQUhGQyxVQUVFQyxxQkFJRkYsa0JBS2lCRSxtQkFBQSxNQUNYQyxTQUFBQSxtQkFBQSxDQUFBQyxFQUFBUixLQURGUSxFQUdFQyxRQUFLVCxNQUFBQSxJQUVOUyxLQUFBVCxjQUFBQSxFQU5IVSw2QkFlQVYsc0JBQXNCVyxFQUFBQSxFQUFnQkYsS0FBQVQsaUJBQ3BDLE1BQUFZLEVBQU1DLFNBQVNDLGVBQUEsd0JBQ2ZELEVBQU9FLFFBQVlKLElBQ25CRSxNQUFBQSxFQUFlRixTQUFBQSxjQUFmLFVBQ0FDLEVBQU9JLFVBQU9ILEVBSmhCQSxFQUFBSSxNQUFBTixFQUZGQyxFQUFBSSxPQUFBSCxPQWVJVCxjQUFXLE1BQUVjLFNBQUFkLGNBQUEsQ0FBQUksRUFBQVAsS0FDWE0sRUFERkEsUUFFT0MsTUFBQUEsSUFFTFcsS0FBQUEsU0FBQUEsRUFDREEsd0JBUUhBLGlCQUFlTCxFQUFBQSxFQUFTTSxLQUFBQSxZQUF4QixNQUFNUixFQUFTRSxTQUFTTSxlQUFlLG1CQUdyQ25CLEVBQU1ZLFFBQVNDLElBQ2ZELE1BQUFBLEVBQU9FLFNBQVlNLGNBQW5CLFVBQ0FSLEVBQU9JLFVBQVFJLEVBQ2ZULEVBQU9JLE1BQU9ILEVBSmhCRCxFQUFBSSxPQUFBSCxPQVlBSixRQUFLUCxNQUNDb0IsS0FBQUEsT0FBU0MsRUFBQUMsSUFBRCxPQUNS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QUNic0QsRUFBS2xCLFVBQVlKLEVBQUFxQixRQUNqQkMsRUFBQXBELE9BQWlCRSxHQUZqQixNQUFNa0QsRUFBT3RELFNBQVNtQyxjQUFjLEtBUXBDLE9BRkFtQixFQUFBbEIsVUFBQSxtQkFDQUYsRUFBR2hDLFVBQU95QyxTQUFWWSxxQkFBQXZCLEdBQ0FzQixFQUFBRSxLQUFBcEQsU0FBQXFELGlCQUFBekIsR0E3RUZXLEVBQUF6QyxPQUFBb0QsR0E0RUVwQixFQUFHaEMsT0FBT3lDLEdBQ0hULElBV0xELGdCQUFTeUIsRUFBQUEsRUFBVS9ELEtBQUFWLGVBQ2pCMEUsRUFBT0MsUUFBU0osSUFMcEIsTUFBQUssRUFBQXpELFNBQUEwRCx1QkFBQTlCLEVBQUFyQyxLQUFBUCxRQURGeUUsRUFBQUUsR0FBQSxRQUtJLFdBTUovRCxPQUFTTSxTQUFBQSxLQUFldUQsRUFBQUcsUUFBQUMsVUFLdEJqRSxTQUFHTSxlQUFlLHdCQUFNNEQsaUJBQUEsUUFBQSxXQUN0QkMsS0FBQUMsdUJBQUtBLFVBQXVCQyxJQUFVQywyQkFGMUN0RSxTQUFTTSxlQUFlLHdCQUF3QjRELGlCQUFpQixPQUFPLFdBTS9ENUQsUUFBVE4sS0FBU00sT0FDUDZELEtBQUtDLHVCQUF1QkMsVUFBVUUsT0FBSSwyQkFJMUN2RSxTQUFHTSxlQUFlLG1CQUFNNEQsaUJBQUEsUUFBQSxXQUN0QkMsS0FBQUMsdUJBQUtBLFVBQXVCQyxJQUFVQywyQkFGMUN0RSxTQUFTTSxlQUFlLG1CQUFtQjRELGlCQUFpQixPQUFPLFdBQy9DLFFBQWZDLEtBQUtoRSxPQUNOZ0UsS0FBS0MsdUJBQXVCQyxVQUFVQyxPQUFPIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudHMsXHJcbiAgbmVpZ2hib3Job29kcyxcclxuICBjdWlzaW5lc1xyXG52YXIgbmV3TWFwXHJcbnZhciBtYXJrZXJzID0gW11cclxuXHJcbi8vIC8qKlxyXG4vLyAgKiBDaGVjayB0byBzZWUgaWYgc2VydmljZSB3b3JrZXIgaXMgc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyIFxyXG4vLyAgKi9cclxuLy8gaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICBcclxuLy8gICAvKiBpZiBpdCBpcywgcmVnaXN0ZXIgdGhlIHNlcnZpY2Ugd29ya2VyICovXHJcbi8vICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuXHJcbi8vICAgICAvLyBBbHJlYWR5IG9uIHRoZSBsYXRlc3QgdmVyc2lvbiwgYmFpbFxyXG4vLyAgICAgaWYoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpe1xyXG4vLyAgICAgICByZXR1cm47XHJcbi8vICAgICB9XHJcbi8vICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhIHdhaXRpbmcgc2VydmljZSB3b3JrZXJcclxuLy8gICAgIGlmIChyZXMud2FpdGluZyl7XHJcbi8vICAgICAgIF91cGRhdGVSZWFkeSgpO1xyXG4vLyAgICAgICByZXR1cm4gXHJcbi8vICAgICB9XHJcblxyXG4vLyAgICAgaWYgKHJlcy5pbnN0YWxsaW5nKSB7XHJcbi8vICAgICAgIF90cmFja0luc3RhbGxpbmcocmVzLmluc3RhbGxpbmcpO1xyXG4vLyAgICAgICByZXR1cm47XHJcbi8vICAgICB9XHJcbiAgICBcclxuLy8gICAgIHJlcy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uKCkge1xyXG4vLyAgICAgICBfdHJhY2tJbnN0YWxsaW5nKHJlcy5pbnN0YWxsaW5nKTtcclxuLy8gICAgIH0pO1xyXG4gICAgXHJcbi8vICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xyXG4vLyAgICAgY29uc29sZS5sb2coJ2Vycm9yIHJlZ2lzdGVyaW5nIHNlcnZpY2Ugd29ya2VyOiAnLGVycm9yKVxyXG4vLyAgIH0pO1xyXG4gIFxyXG4vLyAgIGZ1bmN0aW9uIF90cmFja0luc3RhbGxpbmcod29ya2VyKXtcclxuLy8gICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsZnVuY3Rpb24oKXtcclxuLy8gICAgICAgaWYgKHdvcmtlci5zdGF0ZSA9PSAnaW5zdGFsbGVkJyl7XHJcbi8vICAgICAgICAgX3VwZGF0ZVJlYWR5KHdvcmtlcik7XHJcbi8vICAgICAgIH1cclxuLy8gICAgIH0pXHJcbi8vICAgfVxyXG5cclxuLy8gICB2YXIgZm9jdXNlZEVsZW1lbnQ7XHJcbi8vICAgLyoqXHJcbi8vICAgICogTm90aWZpZXMgdGhlIHVzZXIgdGhhdCBhbiB1cGRhdGVkIFNXIGlzIGF2YWlsYWJsZVxyXG4vLyAgICAqL1xyXG4vLyAgIGZ1bmN0aW9uIF91cGRhdGVSZWFkeSh3b3JrZXIpe1xyXG4vLyAgICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSB1cGRhdGUgYnV0dG9uLCB1cGRhdGUgdGhlIHNlcnZpY2Ugd29ya2VyXHJcbi8vICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBkYXRlLXZlcnNpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oKXtcclxuLy8gICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHthY3Rpb246J3NraXBXYWl0aW5nJ30pO1xyXG4vLyAgICAgfSk7XHJcbi8vICAgICAvLyBJZiB0aGUgdXNlciBjbGlja3MgdGhlIGRpc21pc3MgYnV0dG9uLCBoaWRlIHRoZSB0b2FzdFxyXG4vLyAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpc21pc3MtdmVyc2lvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbigpe1xyXG4vLyAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuLy8gICAgICAgZm9jdXNlZEVsZW1lbnQuZm9jdXMoKVxyXG4vLyAgICAgfSk7XHJcbi8vICAgICAvLyBJZiB0aGUgdG9hc3QgaXMgZGlzcGxheWluZywgbGlzdGVuIGZvciBrZXlib2FyZCBldmVudHNcclxuLy8gICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLGZ1bmN0aW9uKGUpe1xyXG4vLyAgICAgICAvL0NoZWNrIGZvciBUYWIga2V5IHByZXNzXHJcbi8vICAgICAgIGlmKGUua2V5Q29kZSA9PT0gOSl7XHJcbiAgICAgICAgXHJcbi8vICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuLy8gICAgICAgICAgIC8vUHJlc3NlZCBTaGlmdCBUYWJcclxuLy8gICAgICAgICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGZpcnN0VGFiU3RvcCkge1xyXG4vLyAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vICAgICAgICAgICAgIGxhc3RUYWJTdG9wLmZvY3VzKCk7XHJcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjdXJyZW50IGZvY3VzIDonLGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpXHJcbi8vICAgICAgICAgICB9XHJcbi8vICAgICAgICAgfWVsc2V7XHJcbi8vICAgICAgICAgICAvL1ByZXNzZWQgVGFiXHJcbi8vICAgICAgICAgICBpZihkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBsYXN0VGFiU3RvcCkge1xyXG4vLyAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vICAgICAgICAgICAgIGZpcnN0VGFiU3RvcC5mb2N1cygpO1xyXG4vLyAgICAgICAgICAgfVxyXG4vLyAgICAgICAgIH1cclxuLy8gICAgICAgfVxyXG4vLyAgICAgICAvLyBFc2NhcGUgS2V5XHJcbi8vICAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KXtcclxuLy8gICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuLy8gICAgICAgICBmb2N1c2VkRWxlbWVudC5mb2N1cygpXHJcbi8vICAgICAgIH0gXHJcbi8vICAgICB9KTtcclxuXHJcbi8vICAgICAvLyBSZW1lbWJlciB3aGF0IHRoZSBsYXN0IGVsZW1lbnQgdGhhdCB3YXMgZm9jdXNlZCB3YXMsIGFuZCBtYWtlIGl0IGZvY3VzYWJsZSBzbyB3ZSBjYW4gcmV0dXJuIHRvIGl0XHJcbi8vICAgICBmb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XHJcbi8vICAgICBmb2N1c2VkRWxlbWVudC50YWJpbmRleCA9IDE7XHJcbiAgIFxyXG4vLyAgICAgLy8gV2hlbiB0aGUgdG9hc3QgaXMgdmlzaWJsZSwgdGhpcyBpcyB3aGF0IHdlJ2xsIHVzZSB0byB0ZW1wb3JhcmlseSB0cmFwIGZvY3VzXHJcbi8vICAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcgPSAnI3RvYXN0IHAsICN1cGRhdGUtdmVyc2lvbiwgI2Rpc21pc3MtdmVyc2lvbic7XHJcbi8vICAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKTtcclxuLy8gICAgIGZvY3VzYWJsZUVsZW1lbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZm9jdXNhYmxlRWxlbWVudHMpO1xyXG4gICAgXHJcbi8vICAgICB2YXIgZmlyc3RUYWJTdG9wID0gZm9jdXNhYmxlRWxlbWVudHNbMF07XHJcbi8vICAgICB2YXIgbGFzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1tmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLTFdO1xyXG5cclxuLy8gICAgIC8vIE9rIHRpbWUgdG8gc2hvdyB0aGUgdG9hc3QgYW5kIGZvY3VzIG9uIGl0XHJcbi8vICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuLy8gICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2FzdCBwJykuZm9jdXMoKTtcclxuXHJcbi8vICAgfVxyXG4gIFxyXG5cclxuLy8gICAvKipcclxuLy8gICAgKiBMaXN0ZW5zIGZvciBhIGNoYW5nZSBpbiB0aGUgU1csIHJlbG9hZHMgdGhlIHBhZ2UgYXMgYSByZXN1bHRcclxuLy8gICAgKi9cclxuLy8gICB2YXIgcmVmcmVzaGluZztcclxuLy8gICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgZnVuY3Rpb24oKSB7XHJcbi8vICAgICBjb25zb2xlLmxvZygnY29udHJvbGxlciBjaGFuZ2UnKVxyXG4vLyAgICAgaWYgKHJlZnJlc2hpbmcpIHJldHVybjtcclxuLy8gICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuLy8gICAgIHJlZnJlc2hpbmcgPSB0cnVlO1xyXG4vLyAgIH0pO1xyXG4vLyB9XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuICBpbml0TWFwKCk7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxuaW5pdE1hcCA9ICgpID0+IHtcclxuICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XHJcbiAgICAgICAgY2VudGVyOiBbNDAuNzIyMjE2LCAtNzMuOTg3NTAxXSxcclxuICAgICAgICB6b29tOiAxMixcclxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XHJcbiAgICBtYXBib3hUb2tlbjogJ3BrLmV5SjFJam9pWm1GeWNtVnNiSE5qY21sd2RDSXNJbUVpT2lKamFtSmlhVGwzZEhNeE9HeHNNekp3WlRsbVluTjRaSE41SW4wLjZFeTUwZWwwYXR3akR5Z09fY08wc0EnLFxyXG4gICAgbWF4Wm9vbTogMTgsXHJcbiAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnICtcclxuICAgICAgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJyArXHJcbiAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxyXG4gICAgaWQ6ICdtYXBib3guc3RyZWV0cydcclxuICB9KS5hZGRUbyhuZXdNYXApO1xyXG4gIFxyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbiAgfVxyXG4gIFxyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcclxuICAvLyBDcmVhdGUgYSByZXN0YXVyYW50IGNhcmRcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX2NvbnRhaW5lcic7XHJcblxyXG4gIC8vIEFkZCB0aGUgaW1hZ2UgdG8gdGhlIHJlc3RhdXJhbnQgY2FyZFxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX2ltYWdlJztcclxuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5pbWFnZVRleHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKGltYWdlKTtcclxuICBcclxuICAvLyBDcmVhdGUgYSBkaXYgdG8gcGxhY2UgdGV4dCBlbGVtZW50cyBpblxyXG4gIGNvbnN0IGxvd2VyY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICBsb3dlcmNvbnRhaW5lci5jbGFzc05hbWUgPSAncmVzdGF1cmFudF9fdGV4dGNvbnRhaW5lcidcclxuXHJcbiAgLy8gTmFtZSBvZiB0aGUgcmVzdGF1cmFudFxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX25hbWUnXHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKG5hbWUpO1xyXG4gIFxyXG4gIC8vIFJldmlldyBvZiB0aGUgcmVzdGF1cmFudFxyXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHJhdGluZy5jbGFzc05hbWUgPSAncmVzdGF1cmFudF9fcmV2aWV3Y29udGFpbmVyJztcclxuICBjb25zdCBlbXB0eVN0YXJzID0gNSAtIERCSGVscGVyLnJhdGluZ0ZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgZm9yKGxldCBpPTA7IGkgPCBEQkhlbHBlci5yYXRpbmdGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpOyBpKyspe1xyXG4gICAgY29uc3QgZnVsbHN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgIGZ1bGxzdGFyLmNsYXNzTmFtZT1cInJlc3RhdXJhbnRfX3N0YXIgcmVzdGF1cmFudF9fc3Rhci0tZnVsbFwiO1xyXG4gICAgZnVsbHN0YXIuc3JjID0gXCIvaW1nL2Z1bGxzdGFyLnN2Z1wiO1xyXG4gICAgZnVsbHN0YXIuYWx0ID0gXCJcIlxyXG4gICAgcmF0aW5nLmFwcGVuZChmdWxsc3Rhcik7XHJcbiAgfVxyXG4gIGZvcihsZXQgaT0wOyBpIDwgZW1wdHlTdGFyczsgaSsrKXtcclxuICAgIGNvbnN0IGVtcHR5c3RhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgZW1wdHlzdGFyLmNsYXNzTmFtZT1cInJlc3RhdXJhbnRfX3N0YXIgcmVzdGF1cmFudF9fc3Rhci0tZW1wdHlcIjtcclxuICAgIGVtcHR5c3Rhci5zcmMgPSBcIi9pbWcvZW1wdHlzdGFyLnN2Z1wiO1xyXG4gICAgZW1wdHlzdGFyLmFsdD0gXCJcIlxyXG4gICAgcmF0aW5nLmFwcGVuZChlbXB0eXN0YXIpO1xyXG4gIH1cclxuICBsb3dlcmNvbnRhaW5lci5hcHBlbmQocmF0aW5nKTtcclxuICBcclxuICAvLyBDdWlzaW5lIG9mIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjdWlzaW5lLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19jdWlzaW5lJztcclxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChjdWlzaW5lKTtcclxuICBcclxuICAvLyBOZWlnaGJvcmhvb2Qgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudF9fbmVpZ2hib3Job29kXCJcclxuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKG5laWdoYm9yaG9vZCk7XHJcblxyXG4gIC8vIEhSIFNlcGVyYXRpbmcgdGhlIHVwcGVyIGFuZCBsb3dlciBwYXJ0IG9mIHRoZSB0ZXh0IHNlY3Rpb25cclxuICBjb25zdCBociA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hyJyk7XHJcbiAgaHIuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX2hyJztcclxuICBsb3dlcmNvbnRhaW5lci5hcHBlbmQoaHIpO1xyXG5cclxuXHJcblxyXG4gIC8vIEFkZHJlc3Mgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuY2xhc3NOYW1lID0gXCJyZXN0YXVyYW50X19hZGRyZXNzXCJcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsb3dlcmNvbnRhaW5lci5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIC8vIExpbmsgdG8gdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIG1vcmUuY2xhc3NOYW1lID0gXCJyZXN0YXVyYW50X19saW5rXCJcclxuICBtb3JlLmlubmVySFRNTCA9IERCSGVscGVyLnVybFRleHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKG1vcmUpXHJcblxyXG4gIC8vIEFkZCBsb3dlciBjb250YWluZXIgdG8gdGhlIGNhcmRcclxuICBsaS5hcHBlbmQobG93ZXJjb250YWluZXIpXHJcbiAgcmV0dXJuIGxpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5uZXdNYXApO1xyXG4gICAgbWFya2VyLm9uKFwiY2xpY2tcIiwgb25DbGljayk7XHJcbiAgICBmdW5jdGlvbiBvbkNsaWNrKCkge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci5vcHRpb25zLnVybDtcclxuICAgIH1cclxuICB9KTtcclxufSBcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJyxmdW5jdGlvbigpe1xyXG4gIHRoaXMucHJldmlvdXNFbGVtZW50U2libGluZy5jbGFzc0xpc3QuYWRkKCdmaWx0ZXJfX2xhYmVsLS1hY3RpdmUnKVxyXG59KVxyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsZnVuY3Rpb24oKXtcclxuICBpZih0aGlzLnZhbHVlID09PSAnYWxsJyl7XHJcbiAgICB0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LnJlbW92ZSgnZmlsdGVyX19sYWJlbC0tYWN0aXZlJylcclxuICB9XHJcbn0pXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLGZ1bmN0aW9uKCl7XHJcbiAgdGhpcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5hZGQoJ2ZpbHRlcl9fbGFiZWwtLWFjdGl2ZScpO1xyXG59KSBcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdibHVyJyxmdW5jdGlvbigpe1xyXG4gIGlmKHRoaXMudmFsdWUgPT09ICdhbGwnKXtcclxuICAgIHRoaXMucHJldmlvdXNFbGVtZW50U2libGluZy5jbGFzc0xpc3QucmVtb3ZlKCdmaWx0ZXJfX2xhYmVsLS1hY3RpdmUnKTtcclxuICB9XHJcbn0pIl19
