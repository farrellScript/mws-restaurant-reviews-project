let restaurants,neighborhoods,cuisines;var newMap,markers=[];document.addEventListener("DOMContentLoaded",e=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZmFycmVsbHNjcmlwdCIsImEiOiJjamJiaTl3dHMxOGxsMzJwZTlmYnN4ZHN5In0.6Ey50el0atwjDygO_cO0sA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,s=t.selectedIndex,n=e[a].value,r=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,r,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.className="restaurant__container";const a=document.createElement("img");a.className="restaurant__image",a.alt=DBHelper.imageTextForRestaurant(e),a.srcset=DBHelper.imageSrcSetForRestaurant(e),a.src=DBHelper.imageUrlForRestaurant(e),t.append(a);const s=document.createElement("div");s.className="restaurant__textcontainer";const n=document.createElement("h2");n.className="restaurant__name",n.innerHTML=e.name,s.append(n);const r=document.createElement("div");r.className="restaurant__reviewcontainer";const o=5-DBHelper.ratingForRestaurant(e);for(let t=0;t<DBHelper.ratingForRestaurant(e);t++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--full",e.src="/img/fullstar.svg",r.append(e)}for(let e=0;e<o;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--empty",e.src="/img/emptystar.svg",r.append(e)}s.append(r);const l=document.createElement("p");l.className="restaurant__cuisine",l.innerHTML=e.cuisine_type,s.append(l);const c=document.createElement("p");c.className="restaurant__neighborhood",c.innerHTML=e.neighborhood,s.append(c);const i=document.createElement("hr");i.className="restaurant__hr",s.append(i);const u=document.createElement("p");u.className="restaurant__address",u.innerHTML=e.address,s.append(u);const m=document.createElement("a");return m.className="restaurant__link",m.innerHTML=DBHelper.urlTextForRestaurant(e),m.href=DBHelper.urlForRestaurant(e),s.append(m),t.append(s),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url})})}),document.getElementById("neighborhoods-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("neighborhoods-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJtYXJrZXJzIiwiZmV0Y2hDdWlzaW5lcyIsImluaXRNYXAiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJjb25zb2xlIiwiZXJyb3IiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwibmVpZ2hib3Job29kIiwic2VsZWN0Iiwib3B0aW9uIiwiZG9jdW1lbnQiLCJpbm5lckhUTUwiLCJhcHBlbmQiLCJ2YWx1ZSIsIkRCSGVscGVyIiwiZmlsbEN1aXNpbmVzSFRNTCIsImdldEVsZW1lbnRCeUlkIiwiY3Vpc2luZSIsImNlbnRlciIsIkwiLCJtYXAiLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwibWFwYm94VG9rZW4iLCJtYXhab29tIiwiYXR0cmlidXRpb24iLCJpZCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiYWRkVG8iLCJjU2VsZWN0IiwibkluZGV4IiwiblNlbGVjdCIsInNlbGVjdGVkSW5kZXgiLCJjSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsImZvckVhY2giLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsInJlc3RhdXJhbnQiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJpbWFnZSIsInNyY3NldCIsImltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudCIsInNyYyIsImltYWdlVGV4dEZvclJlc3RhdXJhbnQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJsb3dlcmNvbnRhaW5lciIsIm5hbWUiLCJyYXRpbmciLCJyYXRpbmdGb3JSZXN0YXVyYW50IiwiZnVsbHN0YXIiLCJpIiwiZW1wdHlzdGFyIiwiZW1wdHlTdGFycyIsImN1aXNpbmVfdHlwZSIsImhyIiwiYWRkcmVzcyIsIm1vcmUiLCJ1cmxUZXh0Rm9yUmVzdGF1cmFudCIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50Iiwib25DbGljayIsIndpbmRvdyIsImxvY2F0aW9uIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsIm9uIiwib3B0aW9ucyIsInVybCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0aGlzIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsWUFHSkMsY0FDQUMsU0FEQSxJQUFJQyxPQUdKQyxXQXVIRUMsU0FBQUEsaUJBQUFBLG1CQUFBQSxJQUhGQyxVQUVFQyxxQkFJRkYsa0JBS2lCRSxtQkFBQSxNQUNYQyxTQUFBQSxtQkFBQSxDQUFBQyxFQUFBUixLQURGUSxFQUdFQyxRQUFLVCxNQUFBQSxJQUVOUyxLQUFBVCxjQUFBQSxFQU5IVSw2QkFlQVYsc0JBQXNCVyxFQUFBQSxFQUFnQkYsS0FBQVQsaUJBQ3BDLE1BQUFZLEVBQU1DLFNBQVNDLGVBQUEsd0JBQ2ZELEVBQU9FLFFBQVlKLElBQ25CRSxNQUFBQSxFQUFlRixTQUFBQSxjQUFmLFVBQ0FDLEVBQU9JLFVBQU9ILEVBSmhCQSxFQUFBSSxNQUFBTixFQUZGQyxFQUFBSSxPQUFBSCxPQWVJVCxjQUFXLE1BQUVjLFNBQUFkLGNBQUEsQ0FBQUksRUFBQVAsS0FDWE0sRUFERkEsUUFFT0MsTUFBQUEsSUFFTFcsS0FBQUEsU0FBQUEsRUFDREEsd0JBUUhBLGlCQUFlTCxFQUFBQSxFQUFTTSxLQUFBQSxZQUF4QixNQUFNUixFQUFTRSxTQUFTTSxlQUFlLG1CQUdyQ25CLEVBQU1ZLFFBQVNDLElBQ2ZELE1BQUFBLEVBQU9FLFNBQVlNLGNBQW5CLFVBQ0FSLEVBQU9JLFVBQVFJLEVBQ2ZULEVBQU9JLE1BQU9ILEVBSmhCRCxFQUFBSSxPQUFBSCxPQVlBSixRQUFLUCxNQUNDb0IsS0FBQUEsT0FBU0MsRUFBQUMsSUFBRCxPQUNS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QkUsR0FGakIsTUFBTWtELEVBQU90RCxTQUFTbUMsY0FBYyxLQVFwQyxPQUZBbUIsRUFBQWxCLFVBQUEsbUJBQ0FGLEVBQUdoQyxVQUFPeUMsU0FBVlkscUJBQUF2QixHQUNBc0IsRUFBQUUsS0FBQXBELFNBQUFxRCxpQkFBQXpCLEdBM0VGVyxFQUFBekMsT0FBQW9ELEdBMEVFcEIsRUFBR2hDLE9BQU95QyxHQUNIVCxJQVdMRCxnQkFBU3lCLEVBQUFBLEVBQVUvRCxLQUFBVixlQUNqQjBFLEVBQU9DLFFBQVNKLElBTHBCLE1BQUFLLEVBQUF6RCxTQUFBMEQsdUJBQUE5QixFQUFBckMsS0FBQVAsUUFERnlFLEVBQUFFLEdBQUEsUUFLSSxXQU1KL0QsT0FBU00sU0FBQUEsS0FBZXVELEVBQUFHLFFBQUFDLFVBS3RCakUsU0FBR00sZUFBZSx3QkFBTTRELGlCQUFBLFFBQUEsV0FDdEJDLEtBQUFDLHVCQUFLQSxVQUF1QkMsSUFBVUMsMkJBRjFDdEUsU0FBU00sZUFBZSx3QkFBd0I0RCxpQkFBaUIsT0FBTyxXQU0vRDVELFFBQVROLEtBQVNNLE9BQ1A2RCxLQUFLQyx1QkFBdUJDLFVBQVVFLE9BQUksMkJBSTFDdkUsU0FBR00sZUFBZSxtQkFBTTRELGlCQUFBLFFBQUEsV0FDdEJDLEtBQUFDLHVCQUFLQSxVQUF1QkMsSUFBVUMsMkJBRjFDdEUsU0FBU00sZUFBZSxtQkFBbUI0RCxpQkFBaUIsT0FBTyxXQUMvQyxRQUFmQyxLQUFLaEUsT0FDTmdFLEtBQUtDLHVCQUF1QkMsVUFBVUMsT0FBTyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG5ld01hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG4vLyAvKipcclxuLy8gICogQ2hlY2sgdG8gc2VlIGlmIHNlcnZpY2Ugd29ya2VyIGlzIHN1cHBvcnRlZCBieSB0aGUgYnJvd3NlciBcclxuLy8gICovXHJcbi8vIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgXHJcbi8vICAgLyogaWYgaXQgaXMsIHJlZ2lzdGVyIHRoZSBzZXJ2aWNlIHdvcmtlciAqL1xyXG4vLyAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblxyXG4vLyAgICAgLy8gQWxyZWFkeSBvbiB0aGUgbGF0ZXN0IHZlcnNpb24sIGJhaWxcclxuLy8gICAgIGlmKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKXtcclxuLy8gICAgICAgcmV0dXJuO1xyXG4vLyAgICAgfVxyXG4vLyAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZXJlJ3MgYSB3YWl0aW5nIHNlcnZpY2Ugd29ya2VyXHJcbi8vICAgICBpZiAocmVzLndhaXRpbmcpe1xyXG4vLyAgICAgICBfdXBkYXRlUmVhZHkoKTtcclxuLy8gICAgICAgcmV0dXJuIFxyXG4vLyAgICAgfVxyXG5cclxuLy8gICAgIGlmIChyZXMuaW5zdGFsbGluZykge1xyXG4vLyAgICAgICBfdHJhY2tJbnN0YWxsaW5nKHJlcy5pbnN0YWxsaW5nKTtcclxuLy8gICAgICAgcmV0dXJuO1xyXG4vLyAgICAgfVxyXG4gICAgXHJcbi8vICAgICByZXMuYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZm91bmQnLCBmdW5jdGlvbigpIHtcclxuLy8gICAgICAgX3RyYWNrSW5zdGFsbGluZyhyZXMuaW5zdGFsbGluZyk7XHJcbi8vICAgICB9KTtcclxuICAgIFxyXG4vLyAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcclxuLy8gICAgIGNvbnNvbGUubG9nKCdlcnJvciByZWdpc3RlcmluZyBzZXJ2aWNlIHdvcmtlcjogJyxlcnJvcilcclxuLy8gICB9KTtcclxuICBcclxuLy8gICBmdW5jdGlvbiBfdHJhY2tJbnN0YWxsaW5nKHdvcmtlcil7XHJcbi8vICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignc3RhdGVjaGFuZ2UnLGZ1bmN0aW9uKCl7XHJcbi8vICAgICAgIGlmICh3b3JrZXIuc3RhdGUgPT0gJ2luc3RhbGxlZCcpe1xyXG4vLyAgICAgICAgIF91cGRhdGVSZWFkeSh3b3JrZXIpO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9KVxyXG4vLyAgIH1cclxuXHJcbi8vICAgdmFyIGZvY3VzZWRFbGVtZW50O1xyXG4vLyAgIC8qKlxyXG4vLyAgICAqIE5vdGlmaWVzIHRoZSB1c2VyIHRoYXQgYW4gdXBkYXRlZCBTVyBpcyBhdmFpbGFibGVcclxuLy8gICAgKi9cclxuLy8gICBmdW5jdGlvbiBfdXBkYXRlUmVhZHkod29ya2VyKXtcclxuLy8gICAgIC8vIElmIHRoZSB1c2VyIGNsaWNrcyBvbiB0aGUgdXBkYXRlIGJ1dHRvbiwgdXBkYXRlIHRoZSBzZXJ2aWNlIHdvcmtlclxyXG4vLyAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwZGF0ZS12ZXJzaW9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKCl7XHJcbi8vICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7YWN0aW9uOidza2lwV2FpdGluZyd9KTtcclxuLy8gICAgIH0pO1xyXG4vLyAgICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIHRoZSBkaXNtaXNzIGJ1dHRvbiwgaGlkZSB0aGUgdG9hc3RcclxuLy8gICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNtaXNzLXZlcnNpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oKXtcclxuLy8gICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0JykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbi8vICAgICAgIGZvY3VzZWRFbGVtZW50LmZvY3VzKClcclxuLy8gICAgIH0pO1xyXG4vLyAgICAgLy8gSWYgdGhlIHRvYXN0IGlzIGRpc3BsYXlpbmcsIGxpc3RlbiBmb3Iga2V5Ym9hcmQgZXZlbnRzXHJcbi8vICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJyxmdW5jdGlvbihlKXtcclxuLy8gICAgICAgLy9DaGVjayBmb3IgVGFiIGtleSBwcmVzc1xyXG4vLyAgICAgICBpZihlLmtleUNvZGUgPT09IDkpe1xyXG4gICAgICAgIFxyXG4vLyAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XHJcbi8vICAgICAgICAgICAvL1ByZXNzZWQgU2hpZnQgVGFiXHJcbi8vICAgICAgICAgICBpZihkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBmaXJzdFRhYlN0b3ApIHtcclxuLy8gICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgICAgICAgICBsYXN0VGFiU3RvcC5mb2N1cygpO1xyXG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZygnY3VycmVudCBmb2N1cyA6Jyxkb2N1bWVudC5hY3RpdmVFbGVtZW50KVxyXG4vLyAgICAgICAgICAgfVxyXG4vLyAgICAgICAgIH1lbHNle1xyXG4vLyAgICAgICAgICAgLy9QcmVzc2VkIFRhYlxyXG4vLyAgICAgICAgICAgaWYoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gbGFzdFRhYlN0b3ApIHtcclxuLy8gICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgICAgICAgICBmaXJzdFRhYlN0b3AuZm9jdXMoKTtcclxuLy8gICAgICAgICAgIH1cclxuLy8gICAgICAgICB9XHJcbi8vICAgICAgIH1cclxuLy8gICAgICAgLy8gRXNjYXBlIEtleVxyXG4vLyAgICAgICBpZiAoZS5rZXlDb2RlID09PSAyNyl7XHJcbi8vICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0JykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbi8vICAgICAgICAgZm9jdXNlZEVsZW1lbnQuZm9jdXMoKVxyXG4vLyAgICAgICB9IFxyXG4vLyAgICAgfSk7XHJcblxyXG4vLyAgICAgLy8gUmVtZW1iZXIgd2hhdCB0aGUgbGFzdCBlbGVtZW50IHRoYXQgd2FzIGZvY3VzZWQgd2FzLCBhbmQgbWFrZSBpdCBmb2N1c2FibGUgc28gd2UgY2FuIHJldHVybiB0byBpdFxyXG4vLyAgICAgZm9jdXNlZEVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xyXG4vLyAgICAgZm9jdXNlZEVsZW1lbnQudGFiaW5kZXggPSAxO1xyXG4gICBcclxuLy8gICAgIC8vIFdoZW4gdGhlIHRvYXN0IGlzIHZpc2libGUsIHRoaXMgaXMgd2hhdCB3ZSdsbCB1c2UgdG8gdGVtcG9yYXJpbHkgdHJhcCBmb2N1c1xyXG4vLyAgICAgdmFyIGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nID0gJyN0b2FzdCBwLCAjdXBkYXRlLXZlcnNpb24sICNkaXNtaXNzLXZlcnNpb24nO1xyXG4vLyAgICAgdmFyIGZvY3VzYWJsZUVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChmb2N1c2FibGVFbGVtZW50c1N0cmluZyk7XHJcbi8vICAgICBmb2N1c2FibGVFbGVtZW50cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZvY3VzYWJsZUVsZW1lbnRzKTtcclxuICAgIFxyXG4vLyAgICAgdmFyIGZpcnN0VGFiU3RvcCA9IGZvY3VzYWJsZUVsZW1lbnRzWzBdO1xyXG4vLyAgICAgdmFyIGxhc3RUYWJTdG9wID0gZm9jdXNhYmxlRWxlbWVudHNbZm9jdXNhYmxlRWxlbWVudHMubGVuZ3RoIC0xXTtcclxuXHJcbi8vICAgICAvLyBPayB0aW1lIHRvIHNob3cgdGhlIHRvYXN0IGFuZCBmb2N1cyBvbiBpdFxyXG4vLyAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0JykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbi8vICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9hc3QgcCcpLmZvY3VzKCk7XHJcblxyXG4vLyAgIH1cclxuICBcclxuXHJcbi8vICAgLyoqXHJcbi8vICAgICogTGlzdGVucyBmb3IgYSBjaGFuZ2UgaW4gdGhlIFNXLCByZWxvYWRzIHRoZSBwYWdlIGFzIGEgcmVzdWx0XHJcbi8vICAgICovXHJcbi8vICAgdmFyIHJlZnJlc2hpbmc7XHJcbi8vICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmNoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4vLyAgICAgY29uc29sZS5sb2coJ2NvbnRyb2xsZXIgY2hhbmdlJylcclxuLy8gICAgIGlmIChyZWZyZXNoaW5nKSByZXR1cm47XHJcbi8vICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbi8vICAgICByZWZyZXNoaW5nID0gdHJ1ZTtcclxuLy8gICB9KTtcclxuLy8gfVxyXG5cclxuXHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XHJcbiAgaW5pdE1hcCgpO1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xyXG4gICAgICAgIGNlbnRlcjogWzQwLjcyMjIxNiwgLTczLjk4NzUwMV0sXHJcbiAgICAgICAgem9vbTogMTIsXHJcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xyXG4gICAgbWFwYm94VG9rZW46ICdway5leUoxSWpvaVptRnljbVZzYkhOamNtbHdkQ0lzSW1FaU9pSmphbUppYVRsM2RITXhPR3hzTXpKd1pUbG1Zbk40WkhONUluMC42RXk1MGVsMGF0d2pEeWdPX2NPMHNBJyxcclxuICAgIG1heFpvb206IDE4LFxyXG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXHJcbiAgICAgICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICcgK1xyXG4gICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcclxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXHJcbiAgfSkuYWRkVG8obmV3TWFwKTtcclxuICBcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG4gIH1cclxuICBcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgLy8gQ3JlYXRlIGEgcmVzdGF1cmFudCBjYXJkXHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19jb250YWluZXInO1xyXG5cclxuICAvLyBBZGQgdGhlIGltYWdlIHRvIHRoZSByZXN0YXVyYW50IGNhcmRcclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19pbWFnZSc7XHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuaW1hZ2VUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcbiAgXHJcbiAgLy8gQ3JlYXRlIGEgZGl2IHRvIHBsYWNlIHRleHQgZWxlbWVudHMgaW5cclxuICBjb25zdCBsb3dlcmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgbG93ZXJjb250YWluZXIuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX3RleHRjb250YWluZXInXHJcblxyXG4gIC8vIE5hbWUgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19uYW1lJ1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChuYW1lKTtcclxuICBcclxuICAvLyBSZXZpZXcgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX3Jldmlld2NvbnRhaW5lcic7XHJcbiAgY29uc3QgZW1wdHlTdGFycyA9IDUgLSBEQkhlbHBlci5yYXRpbmdGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGZvcihsZXQgaT0wOyBpIDwgREJIZWxwZXIucmF0aW5nRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTsgaSsrKXtcclxuICAgIGNvbnN0IGZ1bGxzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICBmdWxsc3Rhci5jbGFzc05hbWU9XCJyZXN0YXVyYW50X19zdGFyIHJlc3RhdXJhbnRfX3N0YXItLWZ1bGxcIjtcclxuICAgIGZ1bGxzdGFyLnNyYyA9IFwiL2ltZy9mdWxsc3Rhci5zdmdcIjtcclxuICAgIHJhdGluZy5hcHBlbmQoZnVsbHN0YXIpO1xyXG4gIH1cclxuICBmb3IobGV0IGk9MDsgaSA8IGVtcHR5U3RhcnM7IGkrKyl7XHJcbiAgICBjb25zdCBlbXB0eXN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgIGVtcHR5c3Rhci5jbGFzc05hbWU9XCJyZXN0YXVyYW50X19zdGFyIHJlc3RhdXJhbnRfX3N0YXItLWVtcHR5XCI7XHJcbiAgICBlbXB0eXN0YXIuc3JjID0gXCIvaW1nL2VtcHR5c3Rhci5zdmdcIjtcclxuICAgIHJhdGluZy5hcHBlbmQoZW1wdHlzdGFyKTtcclxuICB9XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKHJhdGluZyk7XHJcbiAgXHJcbiAgLy8gQ3Vpc2luZSBvZiB0aGUgcmVzdGF1cmFudFxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY3Vpc2luZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudF9fY3Vpc2luZSc7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuICBsb3dlcmNvbnRhaW5lci5hcHBlbmQoY3Vpc2luZSk7XHJcbiAgXHJcbiAgLy8gTmVpZ2hib3Job29kIG9mIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5jbGFzc05hbWUgPSBcInJlc3RhdXJhbnRfX25laWdoYm9yaG9vZFwiXHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICAvLyBIUiBTZXBlcmF0aW5nIHRoZSB1cHBlciBhbmQgbG93ZXIgcGFydCBvZiB0aGUgdGV4dCBzZWN0aW9uXHJcbiAgY29uc3QgaHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdocicpO1xyXG4gIGhyLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19ocic7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKGhyKTtcclxuXHJcblxyXG5cclxuICAvLyBBZGRyZXNzIG9mIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudF9fYWRkcmVzc1wiXHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICAvLyBMaW5rIHRvIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudF9fbGlua1wiXHJcbiAgbW9yZS5pbm5lckhUTUwgPSBEQkhlbHBlci51cmxUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChtb3JlKVxyXG5cclxuICAvLyBBZGQgbG93ZXIgY29udGFpbmVyIHRvIHRoZSBjYXJkXHJcbiAgbGkuYXBwZW5kKGxvd2VyY29udGFpbmVyKVxyXG4gIHJldHVybiBsaVxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcclxuICAgIG1hcmtlci5vbihcImNsaWNrXCIsIG9uQ2xpY2spO1xyXG4gICAgZnVuY3Rpb24gb25DbGljaygpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIub3B0aW9ucy51cmw7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0gXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsZnVuY3Rpb24oKXtcclxuICB0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LmFkZCgnZmlsdGVyX19sYWJlbC0tYWN0aXZlJylcclxufSlcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLGZ1bmN0aW9uKCl7XHJcbiAgaWYodGhpcy52YWx1ZSA9PT0gJ2FsbCcpe1xyXG4gICAgdGhpcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpbHRlcl9fbGFiZWwtLWFjdGl2ZScpXHJcbiAgfVxyXG59KVxyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJyxmdW5jdGlvbigpe1xyXG4gIHRoaXMucHJldmlvdXNFbGVtZW50U2libGluZy5jbGFzc0xpc3QuYWRkKCdmaWx0ZXJfX2xhYmVsLS1hY3RpdmUnKTtcclxufSkgXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsZnVuY3Rpb24oKXtcclxuICBpZih0aGlzLnZhbHVlID09PSAnYWxsJyl7XHJcbiAgICB0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LnJlbW92ZSgnZmlsdGVyX19sYWJlbC0tYWN0aXZlJyk7XHJcbiAgfVxyXG59KSJdfQ==
