let restaurants,neighborhoods,cuisines;var newMap,markers=[];if("serviceWorker"in navigator){function _trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&_updateReady(e)})}var focusedElement,refreshing;function _updateReady(e){document.getElementById("update-version").addEventListener("click",function(){e.postMessage({action:"skipWaiting"})}),document.getElementById("dismiss-version").addEventListener("click",function(){document.getElementById("toast").classList.remove("active"),focusedElement.focus()}),document.getElementById("toast").addEventListener("keydown",function(e){9===e.keyCode&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),o.focus(),console.log("current focus :",document.activeElement)):document.activeElement===o&&(e.preventDefault(),n.focus())),27===e.keyCode&&(document.getElementById("toast").classList.remove("active"),focusedElement.focus())}),(focusedElement=document.activeElement).tabindex=1;var t=document.querySelectorAll("#toast p, #update-version, #dismiss-version"),n=(t=Array.prototype.slice.call(t))[0],o=t[t.length-1];document.getElementById("toast").classList.add("active"),document.querySelector("#toast p").focus()}navigator.serviceWorker.register("/sw.js").then(function(e){navigator.serviceWorker.controller&&(e.waiting?_updateReady():e.installing?_trackInstalling(e.installing):e.addEventListener("updatefound",function(){_trackInstalling(e.installing)}))}).catch(function(e){console.log("error registering service worker: ",e)}),navigator.serviceWorker.addEventListener("controllerchange",function(){console.log("controller change"),refreshing||(window.location.reload(),refreshing=!0)})}document.addEventListener("DOMContentLoaded",e=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"<your MAPBOX API KEY HERE>",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,o=t.selectedIndex,s=e[n].value,a=t[o].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,a,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),n=document.createElement("img");n.className="restaurant-img",n.alt=DBHelper.imageTextForRestaurant(e),n.srcset=DBHelper.imageSrcSetForRestaurant(e),n.src=DBHelper.imageUrlForRestaurant(e),t.append(n);const o=document.createElement("h2");o.innerHTML=e.name,t.append(o);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const a=document.createElement("p");a.innerHTML=e.address,t.append(a);const r=document.createElement("a");return r.innerHTML=DBHelper.urlTextForRestaurant(e),r.href=DBHelper.urlForRestaurant(e),t.append(r),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url})})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwiX3VwZGF0ZVJlYWR5Iiwid29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0YXRlIiwiZm9jdXNlZEVsZW1lbnQiLCJyZWZyZXNoaW5nIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImUiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJjb25zb2xlIiwibG9nIiwiZmlyc3RUYWJTdG9wIiwibGFzdFRhYlN0b3AiLCJmb2N1cyIsImFjdGl2ZUVsZW1lbnQiLCJmb2N1c2FibGVFbGVtZW50c1N0cmluZyIsImZvY3VzYWJsZUVsZW1lbnRzIiwibGVuZ3RoIiwiYWRkIiwicXVlcnlTZWxlY3RvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZXMiLCJjb250cm9sbGVyIiwid2FpdGluZyIsImluc3RhbGxpbmciLCJfdHJhY2tJbnN0YWxsaW5nIiwiY2F0Y2giLCJlcnJvciIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVsb2FkIiwiZXZlbnQiLCJpbml0TWFwIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiREJIZWxwZXIiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxmIiwic2VsZWN0IiwiZm9yRWFjaCIsIm5laWdoYm9yaG9vZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJjdWlzaW5lIiwiTCIsInRpbGVMYXllciIsIm1hcCIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwidXBkYXRlUmVzdGF1cmFudHMiLCJpZCIsImFkZFRvIiwiY1NlbGVjdCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsInJlc3RhdXJhbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImltYWdlIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwibGkiLCJuYW1lIiwiaW1hZ2VUZXh0Rm9yUmVzdGF1cmFudCIsInNyY3NldCIsImltYWdlU3JjU2V0Rm9yUmVzdGF1cmFudCIsImFkZHJlc3MiLCJtb3JlIiwidXJsVGV4dEZvclJlc3RhdXJhbnQiLCJocmVmIiwidXJsRm9yUmVzdGF1cmFudCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJvbiIsIm9wdGlvbnMiLCJ1cmwiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFlBR0pDLGNBQ0FDLFNBREEsSUFBSUMsT0FHSkMsV0FLRSxHQUFBLGtCQUFBQyxVQUFBLENBNkJNQyxTQUFBQSxpQkFBQUMsR0FDREEsRUFBQUMsaUJBQUEsY0FBQSxXQUhILGFBQUFELEVBQUFFLE9BS0RILGFBQUFDLEtBRUQsSUFBSUcsZUFvRUZDLFdBN0RFSixTQUFBQSxhQUFBQSxHQUVGSyxTQUFBQyxlQUFBLGtCQUFBTCxpQkFBQSxRQUFBLFdBQ0FJLEVBQVNDLGFBQUFBLE9BQWUsa0JBR3ZCRCxTQUhEQyxlQUFBLG1CQUFBTCxpQkFBQSxRQUFBLFdBSUFJLFNBQUFDLGVBQUEsU0FBQUMsVUFBQUMsT0FBQSxVQUNBSCxlQUFTQyxVQUFURCxTQUFTQyxlQUFlLFNBQVNMLGlCQUFpQixVQUFVLFNBQVNRLEdBSy9ELElBQUFBLEVBQUFDLFVBRUVELEVBQUVFLFNBRUZDLFNBQVFDLGdCQUFJQyxJQUNiTCxFQUFBRSxpQkFOSEksRUFPS0MsUUFDSEosUUFBQUMsSUFBQSxrQkFBQVIsU0FBQVksZ0JBSUNaLFNBQUFZLGdCQUFBRixJQUNGTixFQUFBRSxpQkFDRkcsRUFBQUUsVUFLQSxLQUFBUCxFQUFB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LEVBQUdwQixPQUFPc0IscUJBQXFCRCxNQVNqQ0Usb0JBTUFDLHFCQUFxQkMsQ0FBQUEsSUFDckJDLE1BQUcxQixFQUFPd0IsU0FBVjNCLGNBQUEsTUFFTThCLEVBQU92RSxTQUFTeUMsY0FBYyxPQUNwQzhCLEVBQUs3QixVQUFZdUIsaUJBQ2pCSyxFQUFHMUIsSUFBTzJCLFNBQVZDLHVCQUFBUCxHQU5BRyxFQUFNSyxPQUFTdkMsU0FBU3dDLHlCQUF5QlQsR0FRakRHLEVBQU03QixJQUFBQSxTQUFldkMsc0JBQUFpRSxHQUNyQjFCLEVBQUFBLE9BQUFBLEdBTEEsTUFBTWdDLEVBQU92RSxTQUFTeUMsY0FBYyxNQVFwQzhCLEVBQUE3QixVQUFnQjFDLEVBQVN5QyxLQUN6QmtDLEVBQUFBLE9BQVFqQyxHQUxSLE1BQU1ILEVBQWV2QyxTQUFTeUMsY0FBYyxLQVE1Q0YsRUFBYXZDLFVBQVN5QyxFQUFjRixhQUNwQ3FDLEVBQUFBLE9BQUtsQyxHQUVMNEIsTUFBRzFCLEVBQUg1QyxTQUFBeUMsY0FBQSxLQU5Ba0MsRUFBUWpDLFVBQVl1QixFQUFXVSxRQVEvQkwsRUFBQTFCLE9BQUErQixHQUxBLE1BQU1DLEVBQU81RSxTQUFTeUMsY0FBYyxLQVlwQ3JELE9BSkZ3RixFQUFBbEMsVUFBQVIsU0FBQTJDLHFCQUFBWixHQU5FVyxFQUFLRSxLQUFPNUMsU0FBUzZDLGlCQUFpQmQsR0FDdENLLEVBQUcxQixPQUFPZ0MsR0FTVnhGLElBTUcrRSxnQkFBQSxFQUFBL0UsRUFBQWdELEtBQUFoRCxlQUNGQSxFQVBEa0QsUUFBQTJCLElBU0EsTUFBQWUsRUFBQTlDLFNBQUErQyx1QkFBQWhCLEVBQUE3QixLQUFBN0MsUUFORXlGLEVBQU9FLEdBQUcsUUFDVixXQUNFdEQsT0FBT0MsU0FBU2lELEtBQU9FLEVBQU9HLFFBQVFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudHMsXHJcbiAgbmVpZ2hib3Job29kcyxcclxuICBjdWlzaW5lc1xyXG52YXIgbmV3TWFwXHJcbnZhciBtYXJrZXJzID0gW11cclxuXHJcbi8qKlxyXG4gKiBDaGVjayB0byBzZWUgaWYgc2VydmljZSB3b3JrZXIgaXMgc3VwcG9ydGVkIGJ5IHRoZSBicm93c2VyIFxyXG4gKi9cclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICBcclxuICAvKiBpZiBpdCBpcywgcmVnaXN0ZXIgdGhlIHNlcnZpY2Ugd29ya2VyICovXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuXHJcbiAgICAvLyBBbHJlYWR5IG9uIHRoZSBsYXRlc3QgdmVyc2lvbiwgYmFpbFxyXG4gICAgaWYoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpe1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhIHdhaXRpbmcgc2VydmljZSB3b3JrZXJcclxuICAgIGlmIChyZXMud2FpdGluZyl7XHJcbiAgICAgIF91cGRhdGVSZWFkeSgpO1xyXG4gICAgICByZXR1cm4gXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcy5pbnN0YWxsaW5nKSB7XHJcbiAgICAgIF90cmFja0luc3RhbGxpbmcocmVzLmluc3RhbGxpbmcpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlcy5hZGRFdmVudExpc3RlbmVyKCd1cGRhdGVmb3VuZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICBfdHJhY2tJbnN0YWxsaW5nKHJlcy5pbnN0YWxsaW5nKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xyXG4gICAgY29uc29sZS5sb2coJ2Vycm9yIHJlZ2lzdGVyaW5nIHNlcnZpY2Ugd29ya2VyOiAnLGVycm9yKVxyXG4gIH0pO1xyXG4gIFxyXG4gIGZ1bmN0aW9uIF90cmFja0luc3RhbGxpbmcod29ya2VyKXtcclxuICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdzdGF0ZWNoYW5nZScsZnVuY3Rpb24oKXtcclxuICAgICAgaWYgKHdvcmtlci5zdGF0ZSA9PSAnaW5zdGFsbGVkJyl7XHJcbiAgICAgICAgX3VwZGF0ZVJlYWR5KHdvcmtlcik7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICB2YXIgZm9jdXNlZEVsZW1lbnQ7XHJcbiAgLyoqXHJcbiAgICogTm90aWZpZXMgdGhlIHVzZXIgdGhhdCBhbiB1cGRhdGVkIFNXIGlzIGF2YWlsYWJsZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIF91cGRhdGVSZWFkeSh3b3JrZXIpe1xyXG4gICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIG9uIHRoZSB1cGRhdGUgYnV0dG9uLCB1cGRhdGUgdGhlIHNlcnZpY2Ugd29ya2VyXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBkYXRlLXZlcnNpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsZnVuY3Rpb24oKXtcclxuICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHthY3Rpb246J3NraXBXYWl0aW5nJ30pO1xyXG4gICAgfSk7XHJcbiAgICAvLyBJZiB0aGUgdXNlciBjbGlja3MgdGhlIGRpc21pc3MgYnV0dG9uLCBoaWRlIHRoZSB0b2FzdFxyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpc21pc3MtdmVyc2lvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbigpe1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgZm9jdXNlZEVsZW1lbnQuZm9jdXMoKVxyXG4gICAgfSk7XHJcbiAgICAvLyBJZiB0aGUgdG9hc3QgaXMgZGlzcGxheWluZywgbGlzdGVuIGZvciBrZXlib2FyZCBldmVudHNcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLGZ1bmN0aW9uKGUpe1xyXG4gICAgICAvL0NoZWNrIGZvciBUYWIga2V5IHByZXNzXHJcbiAgICAgIGlmKGUua2V5Q29kZSA9PT0gOSl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgIC8vUHJlc3NlZCBTaGlmdCBUYWJcclxuICAgICAgICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGZpcnN0VGFiU3RvcCkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGxhc3RUYWJTdG9wLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjdXJyZW50IGZvY3VzIDonLGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAvL1ByZXNzZWQgVGFiXHJcbiAgICAgICAgICBpZihkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBsYXN0VGFiU3RvcCkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGZpcnN0VGFiU3RvcC5mb2N1cygpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyBFc2NhcGUgS2V5XHJcbiAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KXtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgICBmb2N1c2VkRWxlbWVudC5mb2N1cygpXHJcbiAgICAgIH0gXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBSZW1lbWJlciB3aGF0IHRoZSBsYXN0IGVsZW1lbnQgdGhhdCB3YXMgZm9jdXNlZCB3YXMsIGFuZCBtYWtlIGl0IGZvY3VzYWJsZSBzbyB3ZSBjYW4gcmV0dXJuIHRvIGl0XHJcbiAgICBmb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICBmb2N1c2VkRWxlbWVudC50YWJpbmRleCA9IDE7XHJcbiAgIFxyXG4gICAgLy8gV2hlbiB0aGUgdG9hc3QgaXMgdmlzaWJsZSwgdGhpcyBpcyB3aGF0IHdlJ2xsIHVzZSB0byB0ZW1wb3JhcmlseSB0cmFwIGZvY3VzXHJcbiAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcgPSAnI3RvYXN0IHAsICN1cGRhdGUtdmVyc2lvbiwgI2Rpc21pc3MtdmVyc2lvbic7XHJcbiAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZUVsZW1lbnRzU3RyaW5nKTtcclxuICAgIGZvY3VzYWJsZUVsZW1lbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZm9jdXNhYmxlRWxlbWVudHMpO1xyXG4gICAgXHJcbiAgICB2YXIgZmlyc3RUYWJTdG9wID0gZm9jdXNhYmxlRWxlbWVudHNbMF07XHJcbiAgICB2YXIgbGFzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1tmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLTFdO1xyXG5cclxuICAgIC8vIE9rIHRpbWUgdG8gc2hvdyB0aGUgdG9hc3QgYW5kIGZvY3VzIG9uIGl0XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2FzdCBwJykuZm9jdXMoKTtcclxuXHJcbiAgfVxyXG4gIFxyXG5cclxuICAvKipcclxuICAgKiBMaXN0ZW5zIGZvciBhIGNoYW5nZSBpbiB0aGUgU1csIHJlbG9hZHMgdGhlIHBhZ2UgYXMgYSByZXN1bHRcclxuICAgKi9cclxuICB2YXIgcmVmcmVzaGluZztcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zb2xlLmxvZygnY29udHJvbGxlciBjaGFuZ2UnKVxyXG4gICAgaWYgKHJlZnJlc2hpbmcpIHJldHVybjtcclxuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgIHJlZnJlc2hpbmcgPSB0cnVlO1xyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuICBpbml0TWFwKCk7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxuaW5pdE1hcCA9ICgpID0+IHtcclxuICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XHJcbiAgICAgICAgY2VudGVyOiBbNDAuNzIyMjE2LCAtNzMuOTg3NTAxXSxcclxuICAgICAgICB6b29tOiAxMixcclxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XHJcbiAgICBtYXBib3hUb2tlbjogJzx5b3VyIE1BUEJPWCBBUEkgS0VZIEhFUkU+JyxcclxuICAgIG1heFpvb206IDE4LFxyXG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXHJcbiAgICAgICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICcgK1xyXG4gICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcclxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXHJcbiAgfSkuYWRkVG8obmV3TWFwKTtcclxuICBcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG4gIH1cclxuICBcclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuaW1hZ2VUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSBEQkhlbHBlci51cmxUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XHJcbiAgICBtYXJrZXIub24oXCJjbGlja1wiLCBvbkNsaWNrKTtcclxuICAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLm9wdGlvbnMudXJsO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIH0gXHJcbiAgLyogYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59ICovXHJcbiJdfQ==
