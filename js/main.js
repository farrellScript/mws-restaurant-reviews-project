let restaurants,neighborhoods,cuisines;var newMap,markers=[];if("serviceWorker"in navigator){function _trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&_updateReady(e)})}var focusedElement,refreshing;function _updateReady(e){document.getElementById("update-version").addEventListener("click",function(){e.postMessage({action:"skipWaiting"})}),document.getElementById("dismiss-version").addEventListener("click",function(){document.getElementById("toast").classList.remove("active"),focusedElement.focus()}),document.getElementById("toast").addEventListener("keydown",function(e){9===e.keyCode&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),a.focus(),console.log("current focus :",document.activeElement)):document.activeElement===a&&(e.preventDefault(),n.focus())),27===e.keyCode&&(document.getElementById("toast").classList.remove("active"),focusedElement.focus())}),(focusedElement=document.activeElement).tabindex=1;var t=document.querySelectorAll("#toast p, #update-version, #dismiss-version"),n=(t=Array.prototype.slice.call(t))[0],a=t[t.length-1];document.getElementById("toast").classList.add("active"),document.querySelector("#toast p").focus()}navigator.serviceWorker.register("/sw.js").then(function(e){navigator.serviceWorker.controller&&(e.waiting?_updateReady():e.installing?_trackInstalling(e.installing):e.addEventListener("updatefound",function(){_trackInstalling(e.installing)}))}).catch(function(e){console.log("error registering service worker: ",e)}),navigator.serviceWorker.addEventListener("controllerchange",function(){console.log("controller change"),refreshing||(window.location.reload(),refreshing=!0)})}document.addEventListener("DOMContentLoaded",e=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiZmFycmVsbHNjcmlwdCIsImEiOiJjamJiaTl3dHMxOGxsMzJwZTlmYnN4ZHN5In0.6Ey50el0atwjDygO_cO0sA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,s=e[n].value,r=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,r,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.className="restaurant__container";const n=document.createElement("picture"),a=document.createElement("source");a.srcset=DBHelper.imageWebPSrcSetForRestaurant(e),a.className="restaurant__image",a.type="image/webp",n.append(a);const s=document.createElement("source");s.srcset=DBHelper.imageJpgSrcSetForRestaurant(e),s.className="restaurant__image",s.type="image/jpeg",n.append(s);const r=document.createElement("img");r.className="restaurant__image",r.alt=DBHelper.imageTextForRestaurant(e),r.src=DBHelper.imageUrlForRestaurant(e),n.append(r),t.append(n);const o=document.createElement("div");o.className="restaurant__textcontainer";const c=document.createElement("h2");c.className="restaurant__name",c.innerHTML=e.name,o.append(c);const i=document.createElement("div");i.className="restaurant__reviewcontainer";const l=5-DBHelper.ratingForRestaurant(e);for(let t=0;t<DBHelper.ratingForRestaurant(e);t++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--full",e.src="/img/fullstar.svg",e.alt="",i.append(e)}for(let e=0;e<l;e++){const e=document.createElement("img");e.className="restaurant__star restaurant__star--empty",e.src="/img/emptystar.svg",e.alt="",i.append(e)}o.append(i);const d=document.createElement("p");d.className="restaurant__cuisine",d.innerHTML=e.cuisine_type,o.append(d);const u=document.createElement("p");u.className="restaurant__neighborhood",u.innerHTML=e.neighborhood,o.append(u);const m=document.createElement("hr");m.className="restaurant__hr",o.append(m);const p=document.createElement("p");p.className="restaurant__address",p.innerHTML=e.address,o.append(p);const g=document.createElement("a");return g.className="restaurant__link",g.innerHTML=DBHelper.urlTextForRestaurant(e),g.href=DBHelper.urlForRestaurant(e),o.append(g),t.append(o),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url})})}),document.getElementById("neighborhoods-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("neighborhoods-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("focus",function(){this.previousElementSibling.classList.add("filter__label--active")}),document.getElementById("cuisines-select").addEventListener("blur",function(){"all"===this.value&&this.previousElementSibling.classList.remove("filter__label--active")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwiX3VwZGF0ZVJlYWR5Iiwid29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0YXRlIiwiZm9jdXNlZEVsZW1lbnQiLCJyZWZyZXNoaW5nIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImUiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJjb25zb2xlIiwibG9nIiwiZmlyc3RUYWJTdG9wIiwibGFzdFRhYlN0b3AiLCJmb2N1cyIsImFjdGl2ZUVsZW1lbnQiLCJmb2N1c2FibGVFbGVtZW50c1N0cmluZyIsImZvY3VzYWJsZUVsZW1lbnRzIiwibGVuZ3RoIiwiYWRkIiwicXVlcnlTZWxlY3RvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZXMiLCJjb250cm9sbGVyIiwid2FpdGluZyIsImluc3RhbGxpbmciLCJfdHJhY2tJbnN0YWxsaW5nIiwiY2F0Y2giLCJlcnJvciIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVsb2FkIiwiZXZlbnQiLCJpbml0TWFwIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiREJIZWxwZXIiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxmIiwic2VsZWN0IiwiZm9yRWFjaCIsIm5laWdoYm9yaG9vZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJjdWlzaW5lIiwiTCIsInRpbGVMYXllciIsIm1hcCIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwidXBkYXRlUmVzdGF1cmFudHMiLCJpZCIsImFkZFRvIiwiY1NlbGVjdCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsInJlc3RhdXJhbnQiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsIndlYnBpbWFnZSIsInNyY3NldCIsInBpY3R1cmUiLCJqcGdpbWFnZSIsImltYWdlSnBnU3JjU2V0Rm9yUmVzdGF1cmFudCIsImNsYXNzTmFtZSIsInR5cGUiLCJpbWFnZSIsImltYWdlVGV4dEZvclJlc3RhdXJhbnQiLCJsb3dlcmNvbnRhaW5lciIsImxpIiwibmFtZSIsInJhdGluZyIsImVtcHR5U3RhcnMiLCJpIiwiZnVsbHN0YXIiLCJyYXRpbmdGb3JSZXN0YXVyYW50IiwiZW1wdHlzdGFyIiwiaHIiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJ1cmxGb3JSZXN0YXVyYW50IiwidXJsVGV4dEZvclJlc3RhdXJhbnQiLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwibWFya2VyIiwib24iLCJvcHRpb25zIiwidXJsIiwidGhpcyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsWUFHSkMsY0FDQUMsU0FEQSxJQUFJQyxPQUdKQyxXQUtFLEdBQUEsa0JBQUFDLFVBQUEsQ0E2Qk1DLFNBQUFBLGlCQUFBQyxHQUNEQSxFQUFBQyxpQkFBQSxjQUFBLFdBSEgsYUFBQUQsRUFBQUUsT0FLREgsYUFBQUMsS0FFRCxJQUFJRyxlQW9FRkMsV0E3REVKLFNBQUFBLGFBQUFBLEdBRUZLLFNBQUFDLGVBQUEsa0JBQUFMLGlCQUFBLFFBQUEsV0FDQUksRUFBU0MsYUFBQUEsT0FBZSxrQkFHdkJELFNBSERDLGVBQUEsbUJBQUFMLGlCQUFBLFFBQUEsV0FJQUksU0FBQUMsZUFBQSxTQUFBQyxVQUFBQyxPQUFBLFVBQ0FILGVBQVNDLFVBQVRELFNBQVNDLGVBQWUsU0FBU0wsaUJBQWlCLFVBQVUsU0FBU1EsR0FLL0QsSUFBQUEsRUFBQUMsVUFFRUQsRUFBRUUsU0FF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QyxPQUFBaUMsR0FDQUMsSUFNSFgsZ0JBVEQsRUFBQS9FLEVBQUFnRCxLQUFBaEQsZUFDRUEsRUFBWWtELFFBQVEyQixJQVdwQixNQUFLMkIsRUFBQUEsU0FBQUEsdUJBQXFDM0IsRUFBQTdCLEtBQTFDN0MsUUFERnNHLEVBQUFDLEdBQUEsUUFOSSxXQVVKOUYsT0FBU0MsU0FBQUEsS0FBZTRGLEVBQUFFLFFBQUFDLFVBSnhCaEcsU0FBU0MsZUFBZSx3QkFBd0JMLGlCQUFpQixRQUFRLFdBVXpFSSxLQUFBQSx1QkFBd0JFLFVBQUFjLElBQW1CcEIsMkJBTjNDSSxTQUFTQyxlQUFlLHdCQUF3QkwsaUJBQWlCLE9BQU8sV0FVL0RLLFFBQVRELEtBQVNDLE9BQ1BnRyxLQUFHTCx1QkFBcUIxRixVQUFBQyxPQUFBLDJCQUwxQkgsU0FBU0MsZUFBZSxtQkFBbUJMLGlCQUFpQixRQUFRLFdBQ2xFcUcsS0FBS0wsdUJBQXVCMUYsVUFBVWMsSUFBSSwyQkFHNUNoQixTQUFTQyxlQUFlLG1CQUFtQkwsaUJBQWlCLE9BQU8sV0FDL0MsUUFBZnFHLEtBQUt0RCxPQUNOc0QsS0FBS0wsdUJBQXVCMUYsVUFBVUMsT0FBTyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG5ld01hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG4vKipcclxuICogQ2hlY2sgdG8gc2VlIGlmIHNlcnZpY2Ugd29ya2VyIGlzIHN1cHBvcnRlZCBieSB0aGUgYnJvd3NlciBcclxuICovXHJcbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XHJcbiAgLy8gQ29tbWVudFxyXG4gIC8qIGlmIGl0IGlzLCByZWdpc3RlciB0aGUgc2VydmljZSB3b3JrZXIgKi9cclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihmdW5jdGlvbihyZXMpe1xyXG5cclxuICAgIC8vIEFscmVhZHkgb24gdGhlIGxhdGVzdCB2ZXJzaW9uLCBiYWlsXHJcbiAgICBpZighbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcil7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGEgd2FpdGluZyBzZXJ2aWNlIHdvcmtlclxyXG4gICAgaWYgKHJlcy53YWl0aW5nKXtcclxuICAgICAgX3VwZGF0ZVJlYWR5KCk7XHJcbiAgICAgIHJldHVybiBcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVzLmluc3RhbGxpbmcpIHtcclxuICAgICAgX3RyYWNrSW5zdGFsbGluZyhyZXMuaW5zdGFsbGluZyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmVzLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgIF90cmFja0luc3RhbGxpbmcocmVzLmluc3RhbGxpbmcpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XHJcbiAgICBjb25zb2xlLmxvZygnZXJyb3IgcmVnaXN0ZXJpbmcgc2VydmljZSB3b3JrZXI6ICcsZXJyb3IpXHJcbiAgfSk7XHJcbiAgXHJcbiAgZnVuY3Rpb24gX3RyYWNrSW5zdGFsbGluZyh3b3JrZXIpe1xyXG4gICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpe1xyXG4gICAgICBpZiAod29ya2VyLnN0YXRlID09ICdpbnN0YWxsZWQnKXtcclxuICAgICAgICBfdXBkYXRlUmVhZHkod29ya2VyKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHZhciBmb2N1c2VkRWxlbWVudDtcclxuICAvKipcclxuICAgKiBOb3RpZmllcyB0aGUgdXNlciB0aGF0IGFuIHVwZGF0ZWQgU1cgaXMgYXZhaWxhYmxlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gX3VwZGF0ZVJlYWR5KHdvcmtlcil7XHJcbiAgICAvLyBJZiB0aGUgdXNlciBjbGlja3Mgb24gdGhlIHVwZGF0ZSBidXR0b24sIHVwZGF0ZSB0aGUgc2VydmljZSB3b3JrZXJcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGRhdGUtdmVyc2lvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbigpe1xyXG4gICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe2FjdGlvbjonc2tpcFdhaXRpbmcnfSk7XHJcbiAgICB9KTtcclxuICAgIC8vIElmIHRoZSB1c2VyIGNsaWNrcyB0aGUgZGlzbWlzcyBidXR0b24sIGhpZGUgdGhlIHRvYXN0XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzbWlzcy12ZXJzaW9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKCl7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICBmb2N1c2VkRWxlbWVudC5mb2N1cygpXHJcbiAgICB9KTtcclxuICAgIC8vIElmIHRoZSB0b2FzdCBpcyBkaXNwbGF5aW5nLCBsaXN0ZW4gZm9yIGtleWJvYXJkIGV2ZW50c1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsZnVuY3Rpb24oZSl7XHJcbiAgICAgIC8vQ2hlY2sgZm9yIFRhYiBrZXkgcHJlc3NcclxuICAgICAgaWYoZS5rZXlDb2RlID09PSA5KXtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgLy9QcmVzc2VkIFNoaWZ0IFRhYlxyXG4gICAgICAgICAgaWYoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gZmlyc3RUYWJTdG9wKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgbGFzdFRhYlN0b3AuZm9jdXMoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2N1cnJlbnQgZm9jdXMgOicsZG9jdW1lbnQuYWN0aXZlRWxlbWVudClcclxuICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgIC8vUHJlc3NlZCBUYWJcclxuICAgICAgICAgIGlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGxhc3RUYWJTdG9wKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgZmlyc3RUYWJTdG9wLmZvY3VzKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIEVzY2FwZSBLZXlcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpe1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICAgIGZvY3VzZWRFbGVtZW50LmZvY3VzKClcclxuICAgICAgfSBcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFJlbWVtYmVyIHdoYXQgdGhlIGxhc3QgZWxlbWVudCB0aGF0IHdhcyBmb2N1c2VkIHdhcywgYW5kIG1ha2UgaXQgZm9jdXNhYmxlIHNvIHdlIGNhbiByZXR1cm4gdG8gaXRcclxuICAgIGZvY3VzZWRFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcclxuICAgIGZvY3VzZWRFbGVtZW50LnRhYmluZGV4ID0gMTtcclxuICAgXHJcbiAgICAvLyBXaGVuIHRoZSB0b2FzdCBpcyB2aXNpYmxlLCB0aGlzIGlzIHdoYXQgd2UnbGwgdXNlIHRvIHRlbXBvcmFyaWx5IHRyYXAgZm9jdXNcclxuICAgIHZhciBmb2N1c2FibGVFbGVtZW50c1N0cmluZyA9ICcjdG9hc3QgcCwgI3VwZGF0ZS12ZXJzaW9uLCAjZGlzbWlzcy12ZXJzaW9uJztcclxuICAgIHZhciBmb2N1c2FibGVFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcpO1xyXG4gICAgZm9jdXNhYmxlRWxlbWVudHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmb2N1c2FibGVFbGVtZW50cyk7XHJcbiAgICBcclxuICAgIHZhciBmaXJzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1swXTtcclxuICAgIHZhciBsYXN0VGFiU3RvcCA9IGZvY3VzYWJsZUVsZW1lbnRzW2ZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAtMV07XHJcblxyXG4gICAgLy8gT2sgdGltZSB0byBzaG93IHRoZSB0b2FzdCBhbmQgZm9jdXMgb24gaXRcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvYXN0IHAnKS5mb2N1cygpO1xyXG5cclxuICB9XHJcbiAgXHJcblxyXG4gIC8qKlxyXG4gICAqIExpc3RlbnMgZm9yIGEgY2hhbmdlIGluIHRoZSBTVywgcmVsb2FkcyB0aGUgcGFnZSBhcyBhIHJlc3VsdFxyXG4gICAqL1xyXG4gIHZhciByZWZyZXNoaW5nO1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgIGNvbnNvbGUubG9nKCdjb250cm9sbGVyIGNoYW5nZScpXHJcbiAgICBpZiAocmVmcmVzaGluZykgcmV0dXJuO1xyXG4gICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgcmVmcmVzaGluZyA9IHRydWU7XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGluaXRNYXAoKTtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKGVycm9yLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG5pbml0TWFwID0gKCkgPT4ge1xyXG4gIHNlbGYubmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcclxuICAgICAgICBjZW50ZXI6IFs0MC43MjIyMTYsIC03My45ODc1MDFdLFxyXG4gICAgICAgIHpvb206IDEyLFxyXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcclxuICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2labUZ5Y21Wc2JITmpjbWx3ZENJc0ltRWlPaUpqYW1KaWFUbDNkSE14T0d4c016SndaVGxtWW5ONFpITjVJbjAuNkV5NTBlbDBhdHdqRHlnT19jTzBzQScsXHJcbiAgICBtYXhab29tOiAxOCxcclxuICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgK1xyXG4gICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcclxuICAgICAgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXHJcbiAgICBpZDogJ21hcGJveC5zdHJlZXRzJ1xyXG4gIH0pLmFkZFRvKG5ld01hcCk7XHJcbiAgXHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxuICB9XHJcbiAgXHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcclxuXHJcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5yZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG4gIC8vIENyZWF0ZSBhIHJlc3RhdXJhbnQgY2FyZFxyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5jbGFzc05hbWUgPSAncmVzdGF1cmFudF9fY29udGFpbmVyJztcclxuXHJcbiAgLy8gU2V0dXAgcGljdHVyZSBlbGVtZW50XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBcclxuICAvLyBBZGQgdGhlIGZpcnN0IGltYWdlIHNldCB0byB0aGUgcmVzdGF1cmFudCBjYXJkXHJcbiAgY29uc3Qgd2VicGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgd2VicGltYWdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlV2ViUFNyY1NldEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgd2VicGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19pbWFnZSc7XHJcbiAgd2VicGltYWdlLnR5cGUgPSAnaW1hZ2Uvd2VicCc7XHJcbiAgcGljdHVyZS5hcHBlbmQod2VicGltYWdlKTtcclxuXHJcbiAgLy8gLy8gQWRkIHRoZSBmaXJzdCBpbWFnZSBzZXQgdG8gdGhlIHJlc3RhdXJhbnQgY2FyZFxyXG4gIGNvbnN0IGpwZ2ltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAganBnaW1hZ2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VKcGdTcmNTZXRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGpwZ2ltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19pbWFnZSc7XHJcbiAganBnaW1hZ2UudHlwZSA9ICdpbWFnZS9qcGVnJztcclxuICBwaWN0dXJlLmFwcGVuZChqcGdpbWFnZSk7XHJcblxyXG4gIC8vIEFkZCB0aGUgZmlyc3QgaW1hZ2Ugc2V0IHRvIHRoZSByZXN0YXVyYW50IGNhcmRcclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19pbWFnZSc7XHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuaW1hZ2VUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xyXG5cclxuICBsaS5hcHBlbmQocGljdHVyZSk7XHJcbiAgXHJcbiAgLy8gQ3JlYXRlIGEgZGl2IHRvIHBsYWNlIHRleHQgZWxlbWVudHMgaW5cclxuICBjb25zdCBsb3dlcmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgbG93ZXJjb250YWluZXIuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX3RleHRjb250YWluZXInXHJcblxyXG4gIC8vIE5hbWUgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19uYW1lJ1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChuYW1lKTtcclxuICBcclxuICAvLyBSZXZpZXcgb2YgdGhlIHJlc3RhdXJhbnRcclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnRfX3Jldmlld2NvbnRhaW5lcic7XHJcbiAgY29uc3QgZW1wdHlTdGFycyA9IDUgLSBEQkhlbHBlci5yYXRpbmdGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGZvcihsZXQgaT0wOyBpIDwgREJIZWxwZXIucmF0aW5nRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTsgaSsrKXtcclxuICAgIGNvbnN0IGZ1bGxzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICBmdWxsc3Rhci5jbGFzc05hbWU9XCJyZXN0YXVyYW50X19zdGFyIHJlc3RhdXJhbnRfX3N0YXItLWZ1bGxcIjtcclxuICAgIGZ1bGxzdGFyLnNyYyA9IFwiL2ltZy9mdWxsc3Rhci5zdmdcIjtcclxuICAgIGZ1bGxzdGFyLmFsdCA9IFwiXCJcclxuICAgIHJhdGluZy5hcHBlbmQoZnVsbHN0YXIpO1xyXG4gIH1cclxuICBmb3IobGV0IGk9MDsgaSA8IGVtcHR5U3RhcnM7IGkrKyl7XHJcbiAgICBjb25zdCBlbXB0eXN0YXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgIGVtcHR5c3Rhci5jbGFzc05hbWU9XCJyZXN0YXVyYW50X19zdGFyIHJlc3RhdXJhbnRfX3N0YXItLWVtcHR5XCI7XHJcbiAgICBlbXB0eXN0YXIuc3JjID0gXCIvaW1nL2VtcHR5c3Rhci5zdmdcIjtcclxuICAgIGVtcHR5c3Rhci5hbHQ9IFwiXCJcclxuICAgIHJhdGluZy5hcHBlbmQoZW1wdHlzdGFyKTtcclxuICB9XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKHJhdGluZyk7XHJcbiAgXHJcbiAgLy8gQ3Vpc2luZSBvZiB0aGUgcmVzdGF1cmFudFxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY3Vpc2luZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudF9fY3Vpc2luZSc7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuICBsb3dlcmNvbnRhaW5lci5hcHBlbmQoY3Vpc2luZSk7XHJcbiAgXHJcbiAgLy8gTmVpZ2hib3Job29kIG9mIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5jbGFzc05hbWUgPSBcInJlc3RhdXJhbnRfX25laWdoYm9yaG9vZFwiXHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICAvLyBIUiBTZXBlcmF0aW5nIHRoZSB1cHBlciBhbmQgbG93ZXIgcGFydCBvZiB0aGUgdGV4dCBzZWN0aW9uXHJcbiAgY29uc3QgaHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdocicpO1xyXG4gIGhyLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50X19ocic7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKGhyKTtcclxuXHJcblxyXG5cclxuICAvLyBBZGRyZXNzIG9mIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudF9fYWRkcmVzc1wiXHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbG93ZXJjb250YWluZXIuYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICAvLyBMaW5rIHRvIHRoZSByZXN0YXVyYW50XHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudF9fbGlua1wiXHJcbiAgbW9yZS5pbm5lckhUTUwgPSBEQkhlbHBlci51cmxUZXh0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxvd2VyY29udGFpbmVyLmFwcGVuZChtb3JlKVxyXG5cclxuICAvLyBBZGQgbG93ZXIgY29udGFpbmVyIHRvIHRoZSBjYXJkXHJcbiAgbGkuYXBwZW5kKGxvd2VyY29udGFpbmVyKVxyXG4gIHJldHVybiBsaVxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcclxuICAgIG1hcmtlci5vbihcImNsaWNrXCIsIG9uQ2xpY2spO1xyXG4gICAgZnVuY3Rpb24gb25DbGljaygpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIub3B0aW9ucy51cmw7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0gXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsZnVuY3Rpb24oKXtcclxuICB0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LmFkZCgnZmlsdGVyX19sYWJlbC0tYWN0aXZlJylcclxufSlcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLGZ1bmN0aW9uKCl7XHJcbiAgaWYodGhpcy52YWx1ZSA9PT0gJ2FsbCcpe1xyXG4gICAgdGhpcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpbHRlcl9fbGFiZWwtLWFjdGl2ZScpXHJcbiAgfVxyXG59KVxyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJyxmdW5jdGlvbigpe1xyXG4gIHRoaXMucHJldmlvdXNFbGVtZW50U2libGluZy5jbGFzc0xpc3QuYWRkKCdmaWx0ZXJfX2xhYmVsLS1hY3RpdmUnKTtcclxufSkgXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsZnVuY3Rpb24oKXtcclxuICBpZih0aGlzLnZhbHVlID09PSAnYWxsJyl7XHJcbiAgICB0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LnJlbW92ZSgnZmlsdGVyX19sYWJlbC0tYWN0aXZlJyk7XHJcbiAgfVxyXG59KSJdfQ==
